(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-44538f6d"],{1:function(t,o){},2:function(t,o){},"2fda":function(t,o,i){},3:function(t,o){},a777:function(t,o,i){"use strict";i("2fda")},c42a:function(t,o,i){"use strict";i("dc91")},cd34:function(t,o,i){"use strict";var e=function(){var t=this,o=t.$createElement,i=t._self._c||o;return i("div",{staticClass:"upload-design-image"},[i("input",{staticClass:"upload-image",attrs:{type:"file",accept:"image/gif, image/jpeg ,image/png",name:"file"},on:{change:t.fileChange}}),i("a-drawer",{staticClass:"rotate-drawer",attrs:{width:t.screenWidth,title:"图片旋转",placement:"right",closable:!1,visible:t.visible,mask:!1},on:{close:t.onClose}},[i("a-button",{staticClass:"rotate-button r-btn",attrs:{size:"small",type:"danger"},on:{click:t.rotateImage}},[t._v("旋转图片")]),i("a-button",{staticClass:"confirm-button r-btn",attrs:{size:"small",type:"primary"},on:{click:t.confirmClick}},[t._v("确定上传")]),i("a-button",{staticClass:"cancel-button r-btn",attrs:{size:"small",type:"primary"},on:{click:t.onClose}},[t._v("取消上传")]),t._e(),i("canvas",{ref:"rotateCanvas",attrs:{width:t.screenWidth,height:t.screenHeight,id:"rotate-canvas"}})],1)],1)},s=[],a=(i("b0c0"),function(){var t=this,o=t.$createElement,i=t._self._c||o;return i("div",[!0===t.showChooseBtn&&!0===t.isModal?i("div",{on:{click:t.handleOpen}},[t._t("openImgCutter"),t._t("open")],2):t._e(),t.$slots.openImgCutter||t.$slots.open||!0!==t.isModal?t._e():i("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:t.handleOpen}},[t._v(" "+t._s(t.label)+" ")]),i("transition",{attrs:{name:"fade"}},[t.visible?i("div",{ref:"mask",class:!0===t.isModal?"mask vue-img-cutter":""},[t.visible?i("div",{class:!0===t.isModal?"dialogBoxModal":"dialogBox"},[i("transition",{attrs:{name:"fade","enter-class":"fade-in-enter","enter-active-class":"fade-in-active","leave-class":"fade-out-enter","leave-active-class":"fade-out-active"}},[i("div",{ref:"dialogMainModalRef",class:!0===t.isModal?"dialogMainModal":"dialogMain",style:"width:"+(!0===t.isModal?t.boxWidth+32:t.boxWidth)+"px"},[i("div",{staticClass:"toolMain"},[!0===t.isModal?i("div",{staticClass:"tool-title"},[t._v(" 图片裁剪 "),i("span",{staticClass:"closeIcon",on:{click:t.handleClose}},[t._v("×")])]):t._e(),i("div",{ref:"toolBox",staticClass:"toolBox",style:"height:"+t.boxHeight+"px;width:"+t.boxWidth+"px",on:{mousemove:t.controlBtnMouseMove,mouseup:t.controlBtnMouseUp,mouseleave:t.controlBtnMouseUp,touchmove:t.controlBtnMouseMove,touchend:t.controlBtnMouseUp}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.drawImg.img&&!0===t.showChooseBtn,expression:"!drawImg.img && showChooseBtn === true"}],staticClass:"tips"},[i("div",{staticClass:"btn btn-warning btn-xs",on:{click:t.chooseImg}},[t._v(" "+t._s(t.label)+" ")])]),1==t.tool?i("div",{directives:[{name:"show",rawName:"v-show",value:t.drawImg.img&&!0!==t.dropImg.active&&1==t.controlBox.disable&&1==t.toolBox.disable,expression:"\n                                        drawImg.img &&\n                                        dropImg.active !== true &&\n                                        controlBox.disable == true &&\n                                        toolBox.disable == true\n                                    "}],staticClass:"dockMain",style:"background:"+t.toolBgc,on:{mouseenter:t.dropImgOff}},[t.rate?i("div",{staticClass:"dockBtn"},[t._t("ratio",(function(){return[t._v(" Ratio: ")]})),t._v(" "+t._s(t.rate)+" ")],2):t._e(),i("div",{staticClass:"dockBtn",on:{click:t.scaleReset}},[t._t("scaleReset",(function(){return[t._v(" Scale: ")]})),t._v(" "+t._s(t.drawImg.swidth>0?(t.drawImg.width/t.drawImg.swidth).toFixed(2):"-")+" ")],2),!1===t.originalGraph?i("div",{staticClass:"dockBtn",on:{click:function(o){return t.turnImg(-90)}}},[t._t("turnLeft",(function(){return[t._v(" ↳ ")]}))],2):t._e(),!1===t.originalGraph?i("div",{staticClass:"dockBtn",on:{click:function(o){return t.turnImg(90)}}},[t._t("turnRight",(function(){return[t._v(" ↲ ")]}))],2):t._e(),!1===t.originalGraph?i("div",{staticClass:"dockBtn",on:{click:function(o){return t.turnReset()}}},[t._t("reset",(function(){return[t._v(" ↻ ")]}))],2):t._e(),!1===t.originalGraph?i("div",{staticClass:"dockBtnScrollBar"},[i("div",{ref:"dockBtnScrollControl",staticClass:"scrollBarControl",style:"left:"+t.rotateControl.position+"px",on:{mousemove:t.scrollBarControlMove,mousedown:t.scrollBarControlOn,mouseleave:t.scrollBarControlOff,mouseup:t.scrollBarControlOff}}),1==t.rotateControl.active?i("div",{staticClass:"scrollBarText",style:"left:"+t.rotateControl.position+"px"},[t._v(" "+t._s(t.rotateImg.angle.toFixed(0)+"°")+" ")]):t._e()]):t._e(),!1===t.originalGraph?i("div",{staticClass:"dockBtn",on:{click:t.flipHorizontal}},[t._t("flipHorizontal",(function(){return[t._v(" ⇆ ")]}))],2):t._e(),!1===t.originalGraph?i("div",{staticClass:"dockBtn",on:{click:t.flipVertically}},[t._t("turnRight",(function(){return[t._v(" ⇅ ")]}))],2):t._e()]):t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:null!=t.drawImg.img,expression:"drawImg.img != null"}],ref:"toolBoxControl",staticClass:"toolBoxControl",on:{mousedown:t.toolBoxMouseDown,mouseup:t.toolBoxMouseUp,mousemove:t.toolBoxMouseMove,mouseleave:t.toolBoxMouseLeave,touchstart:t.toolBoxMouseDown,touchmove:t.toolBoxMouseMove,touchend:t.toolBoxMouseUp}},[i("div",{staticClass:"toolBoxControlBox"},[i("div",{staticClass:"controlBox"},[i("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineTop"}),i("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineBottom"}),i("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineLeft"}),i("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineRight"}),!1===t.originalGraph?i("div",{staticClass:"selectArea"},[t._v(" 宽:"+t._s(t.toolBox.width)+" 高:"+t._s(t.toolBox.height)+" (x:"+t._s(t.toolBoxPosition.x)+",y:"+t._s(t.toolBoxPosition.y)+") ")]):t._e(),!0===t.originalGraph?i("div",{staticClass:"selectArea"},[t._v(" 宽:"+t._s((t.toolBox.width/(t.drawImg.width/t.drawImg.swidth)).toFixed(0))+" 高:"+t._s((t.toolBox.height/(t.drawImg.width/t.drawImg.swidth)).toFixed(0))+" (x:"+t._s(t.toolBoxPosition.x)+",y:"+t._s(t.toolBoxPosition.y)+") ")]):t._e(),!0===t.sizeChange?i("div",{staticClass:"leftUp controlBtn",attrs:{"data-name":"leftUp"},on:{mousedown:function(o){return t.controlBtnMouseDown(o,"leftUp")},touchstart:function(o){return t.controlBtnMouseDown(o,"leftUp")}}}):t._e(),!0===t.sizeChange?i("div",{staticClass:"leftDown controlBtn",attrs:{"data-name":"leftDown"},on:{mousedown:function(o){return t.controlBtnMouseDown(o,"leftDown")},touchstart:function(o){return t.controlBtnMouseDown(o,"leftDown")}}}):t._e(),!0===t.sizeChange?i("div",{staticClass:"rightUp controlBtn",attrs:{"data-name":"rightUp"},on:{mousedown:function(o){return t.controlBtnMouseDown(o,"rightUp")},touchstart:function(o){return t.controlBtnMouseDown(o,"rightUp")}}}):t._e(),!0===t.sizeChange?i("div",{staticClass:"rightDown controlBtn",attrs:{"data-name":"rightDown"},on:{mousedown:function(o){return t.controlBtnMouseDown(o,"rightDown")},touchstart:function(o){return t.controlBtnMouseDown(o,"rightDown")}}}):t._e(),!0===t.sizeChange&&!t.rate&&t.toolBox.width>20?i("div",{staticClass:"topCenter controlBtn",attrs:{"data-name":"topCenter"},on:{mousedown:function(o){return t.controlBtnMouseDown(o,"topCenter")},touchstart:function(o){return t.controlBtnMouseDown(o,"topCenter")}}}):t._e(),!0===t.sizeChange&&!t.rate&&t.toolBox.width>20?i("div",{staticClass:"downCenter controlBtn",attrs:{"data-name":"downCenter"},on:{mousedown:function(o){return t.controlBtnMouseDown(o,"downCenter")},touchstart:function(o){return t.controlBtnMouseDown(o,"downCenter")}}}):t._e(),!0===t.sizeChange&&!t.rate&&t.toolBox.height>20?i("div",{staticClass:"leftCenter controlBtn",attrs:{"data-name":"leftCenter"},on:{mousedown:function(o){return t.controlBtnMouseDown(o,"leftCenter")},touchstart:function(o){return t.controlBtnMouseDown(o,"leftCenter")}}}):t._e(),!0===t.sizeChange&&!t.rate&&t.toolBox.height>20?i("div",{staticClass:"rightCenter controlBtn",attrs:{"data-name":"rightCenter"},on:{mousedown:function(o){return t.controlBtnMouseDown(o,"rightCenter")},touchstart:function(o){return t.controlBtnMouseDown(o,"rightCenter")}}}):t._e()]),i("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-1"}),i("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-2"}),i("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-3"}),i("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-4"})])]),i("canvas",{ref:"canvasSelectBox",staticClass:"canvasSelectBox",attrs:{width:t.boxWidth,height:t.boxHeight},on:{mousedown:t.dropImgOn,mouseup:t.dropImgOff,mousemove:t.dropImgMove}}),i("canvas",{ref:"canvas",staticClass:"canvas",attrs:{width:t.boxWidth,height:t.boxHeight}})])]),i("div",{staticClass:"i-dialog-footer"},[i("input",{ref:"inputFile",staticStyle:{width:"1px",height:"1px",border:"none",opacity:"0"},attrs:{type:"file",accept:"image/gif, image/jpeg ,image/png"},on:{change:t.putImgToCanv}}),i("span",{on:{click:t.chooseImg}},[t._t("choose",(function(){return[!0===t.showChooseBtn?i("div",{staticClass:"btn btn-primary btn-primary-plain"},[t._v(" "+t._s(t.label)+" ")]):t._e()]}))],2),i("div",{staticClass:"btn-group fr"},[i("span",{on:{click:t.handleClose}},[t._t("cancel",(function(){return[i("button",{staticClass:"btn btn-default",attrs:{type:"button"}},[t._v("取消")])]}))],2),i("span",{on:{click:function(o){return t.cropPicture(!1)}}},[t._t("confirm",(function(){return[i("button",{staticClass:"btn btn-primary",staticStyle:{"margin-left":"15px"},attrs:{type:"button",disabled:!t.drawImg.img}},[t._v(" 确定 ")])]}))],2)])])])]),i("div",{staticStyle:{clear:"both"}})],1):t._e()]):t._e()])],1)}),r=[],n=i("5530"),l=i("53ca"),h=(i("a9e3"),i("ac1f"),i("1276"),i("466d"),i("d3b7"),i("5cc6"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),{name:"ImgCutter",props:{crossOrigin:{type:Boolean,default:!1,required:!1},crossOriginHeader:{type:String,default:"*",required:!1},label:{type:String,default:"选择图片",required:!1},isModal:{type:Boolean,default:!0,required:!1},lockScroll:{type:Boolean,default:!0,required:!1},showChooseBtn:{type:Boolean,default:!0,required:!1},boxWidth:{type:Number,default:800,required:!1},boxHeight:{type:Number,default:400,required:!1},cutWidth:{type:Number,default:200,required:!1},cutHeight:{type:Number,default:200,required:!1},rate:{type:String,default:null,required:!1},tool:{type:Boolean,default:!0,required:!1},toolBgc:{type:String,default:"#fff",required:!1},imgMove:{type:Boolean,default:!0,required:!1},sizeChange:{type:Boolean,default:!0,required:!1},originalGraph:{type:Boolean,default:!1,required:!1},moveAble:{type:Boolean,default:!0,required:!1},previewMode:{type:Boolean,default:!0,required:!1},CuttingOriginal:{type:Boolean,default:!1,required:!1},WatermarkText:{type:String,default:"",required:!1},WatermarkTextFont:{type:String,default:"12px Sans-serif",required:!1},WatermarkTextColor:{type:String,default:"#fff",required:!1},WatermarkTextX:{type:Number,default:.95,required:!1},WatermarkTextY:{type:Number,default:.95,required:!1},smallToUpload:{type:Boolean,default:!1,required:!1},saveCutPosition:{type:Boolean,default:!1,required:!1},scaleAble:{type:Boolean,default:!0,required:!1},index:{default:null,required:!1},fileType:{default:"png",required:!1,type:String},toolBoxOverflow:{type:Boolean,default:!0,required:!1},DoNotDisplayCopyright:{type:Boolean,default:!1,required:!1}},model:["label","boxWidth","boxHeight","rate","tool","DoNotDisplayCopyright"],data:function(){var t,o;return t=this.boxWidth/2,o=this.boxHeight/2,{version:"",visible:!1,fileName:"",cutImageObj:null,onPrintImgTimmer:null,toolBoxPosition:{x:0,y:0},drawImg:{img:null,sx:0,sy:0,swidth:0,sheight:0,x:0,y:0,width:0,height:0},toolBox:{disable:!0,width:t,height:o,x:0,y:0,boxMove:{start:{x:0,y:0},moveTo:{x:0,y:0}}},dropImg:{active:!1,pageX:0,pageY:0,params:{}},rotateImg:{angle:0},rotateControl:{active:!1,start:{x:0,y:0},position:100},scaleImg:{rate:0,params:{}},controlBox:{disable:!0,btnName:"",start:{x:0,y:0,width:0,height:0}},selectBox:!1,selectBoxColor:"rgba(0,0,0,0.6)",isFlipHorizontal:!1,isFlipVertically:!1}},mounted:function(){var t=this;!1===this.isModal&&(this.visible=!0,this.$nextTick((function(){t.$refs["toolBox"]&&(t.$refs["toolBox"].onmousewheel=t.scaleImgWheel,t.$refs["toolBox"].addEventListener("DOMMouseScroll",t.scaleImgWheel))})))},methods:{handleOpen:function(t){var o=this,i=function(t){if(o.$refs["toolBox"]&&(o.$refs["toolBox"].onmousewheel=o.scaleImgWheel,o.$refs["toolBox"].addEventListener("DOMMouseScroll",o.scaleImgWheel)),!0===o.isModal){!0===o.lockScroll&&(document.documentElement.style.overflowY=document.body.style.overflowY="hidden");var i=o.$refs["dialogMainModalRef"].offsetHeight+200,e=window.innerHeight,s=o.$refs["mask"];s.style.overflowY=i>e?"scroll":"hidden"}t&&"function"===typeof t&&t()};if(t&&"object"==Object(l["a"])(t)&&t.src){if(!t.name)throw new Error("传入参数必须包含：src,name");var e=new Image;!0===this.crossOrigin&&(e.crossOrigin=this.crossOriginHeader),e.name=t.name,e.style.position="fixed",e.style.top=-5e3,e.style.opacity=0,e.onerror=function(t){console.error("图片加载失败"),o.$emit("error",{index:o.index,event:t,msg:"图片加载失败"}),o.clearCutImageObj()},e.onload=function(){if(!0!==e.complete)throw new Error("图片加载失败");o.visible=!0,o.$nextTick((function(){i((function(){o.importImgToCanv(e)}))}))},e.src=t.src,this.cutImageObj=e,document.body.appendChild(e),this.$emit("onChooseImg",t,this.index)}else this.visible=!0,this.$nextTick((function(){i()}))},handleClose:function(){var t=this;this.clearAll(),!0===this.isModal&&(!0===this.lockScroll&&(document.documentElement.style.overflowY=document.body.style.overflowY="scroll"),this.$nextTick((function(){t.visible=!1})))},chooseImg:function(){this.$refs["inputFile"].click()},importImgToCanv:function(t){var o,i=t.height,e=t.width,s=this.boxWidth,a=this.boxHeight,r=Object(n["a"])({},this.drawImg);this.fileName=t.name,r.img=t,this.scaleImg.rate=e/i,i<a&&e<s?(o=1,r.x=(s-e)/2,r.y=(a-i)/2):e/i<=s/a?(o=a/i,r.x=(s-e*o)/2):(o=s/e,r.y=(a-i*o)/2),r.swidth=e,r.sheight=i,r.width=e*o,r.height=i*o,r.x=(s-r.width)/2,r.y=(a-r.height)/2,this.$set(this,"drawImg",r),this.printImg(),this.putToolBox()},putImgToCanv:function(t){var o,i=this;if(!t.target.files)return console.error("IE9及以下需要自己传入image对象"),!1;if(o=t.target.files[0]||null,o){this.fileName=o.name;var e=new FileReader;e.readAsDataURL(o),e.onload=function(t){var s=t.target.result,a=document.createElement("img");a.src=s;var r=setInterval((function(){if(2===e.readyState){if(clearInterval(r),!i.sizeChange&&i.smallToUpload&&a.width<=i.cutWidth&&a.height<=i.cutHeight)return i.handleClose(),o.name=i.changeFileName(o.name,i.fileType),void i.$emit("cutDown",{filename:i.changeFileName(o.name,i.fileType),file:o,index:i.index});var t,s=a.height,l=a.width,h=i.boxWidth,d=i.boxHeight,c=Object(n["a"])({},i.drawImg);c.img=a,i.scaleImg.rate=l/s,s<d&&l<h?(t=1,c.x=(h-l)/2,c.y=(d-s)/2):l/s<=h/d?(t=d/s,c.x=(h-l*t)/2):(t=h/l,c.y=(d-s*t)/2),c.swidth=l,c.sheight=s,c.width=l*t,c.height=s*t,c.x=(h-c.width)/2,c.y=(d-c.height)/2,i.$set(i,"drawImg",c),i.printImg(),i.putToolBox()}}),200)},this.$emit("onChooseImg",o,this.index)}},putToolBox:function(){this.toolBoxOverflow?(this.toolBox.width!==this.boxWidth/2&&this.toolBox.height!==this.boxHeight/2&&!1!==this.saveCutPosition||(this.toolBox.width=this.cutWidth>this.boxWidth?this.boxWidth:this.cutWidth,this.toolBox.height=this.cutHeight>this.boxHeight?this.boxHeight:this.cutHeight),(0===this.toolBox.x&&0===this.toolBox.y||!1===this.saveCutPosition)&&(this.toolBox.x=this.boxWidth/2-this.toolBox.width/2,this.toolBox.y=this.boxHeight/2-this.toolBox.height/2)):(this.toolBox.x=this.drawImg.x,this.toolBox.y=this.drawImg.y,this.toolBox.width=this.drawImg.width,this.toolBox.height=this.drawImg.height),this.drawControlBox(this.toolBox.width,this.toolBox.height,this.toolBox.x,this.toolBox.y)},isSupportFileApi:function(){return!!(window.File&&window.FileList&&window.FileReader&&window.Blob&&-1===navigator.userAgent.indexOf("Edge")&&-1===navigator.userAgent.indexOf("MSIE")&&-1===navigator.userAgent.indexOf("Trident"))},dataURLtoFile:function(t,o){var i=t.split(","),e=i[0].match(/:(.*?);/)[1],s=atob(i[1]),a=s.length,r=new Uint8Array(a);while(a--)r[a]=s.charCodeAt(a);if(this.isSupportFileApi()){var n=new File([r],o,{type:e});return n}return"不支持File对象"},clearAll:function(){var t=this,o=t.$refs["canvas"],i=o.getContext("2d");i.clearRect(0,0,o.width,o.height);var e=t.$refs["canvasSelectBox"],s=e.getContext("2d");s.clearRect(0,0,e.width,e.height);var a=t.drawImg.sx,r=t.drawImg.sy;this.drawImg={img:null,sx:a,sy:r,swidth:0,sheight:0,x:0,y:0,width:0,height:0},this.isFlipHorizontal=!1,this.isFlipVertically=!1,this.$refs["inputFile"].value="",this.rotateImg.angle=0,this.drawImg.img=null,this.turnReset(),this.clearCutImageObj(),this.$emit("onClearAll",this.index)},clearCutImageObj:function(){null!==this.cutImageObj&&void 0!==this.cutImageObj&&("function"===typeof this.cutImageObj.remove?this.cutImageObj.remove():this.cutImageObj.removeNode()),this.cutImageObj=null},drawControlBox:function(t,o,i,e){var s=this;this.toolBoxOverflow?(t>this.boxWidth&&(t=this.boxWidth),o>this.boxHeight&&(o=this.boxHeight),i<0&&(i=0),e<0&&(e=0)):(t>this.drawImg.width&&(t=this.drawImg.width),o>this.drawImg.height&&(o=this.drawImg.height),i<this.drawImg.x&&(i=this.drawImg.x),e<this.drawImg.y&&(e=this.drawImg.y),i>this.drawImg.x+this.drawImg.width-t&&(i=this.drawImg.x+this.drawImg.width-t),e>this.drawImg.y+this.drawImg.height-o&&(e=this.drawImg.y+this.drawImg.height-o));var a,r,n=this.$refs["toolBoxControl"],l=this.$refs["canvasSelectBox"],h=l.getContext("2d");if(h.fillStyle=this.selectBoxColor,h.clearRect(0,0,l.width,l.height),h.fillRect(0,0,l.width,l.height),this.rate&&""!==this.rate){var d=this.rate.split(":")[0]/this.rate.split(":")[1];d>=1?(a=t,r=t/d):(a=o*d,r=o)}else a=t,r=o;this.toolBox.width=a,this.toolBox.height=r,n.style.width=Math.abs(a)+"px",n.style.height=Math.abs(r)+"px",this.toolBox.boxMove.moveTo.x=i,this.toolBox.boxMove.moveTo.y=e,a<0&&(i+=a),r<0&&(e+=r),i+this.toolBox.width>this.boxWidth&&(i=this.boxWidth-this.toolBox.width),i<0&&(i=0),e+this.toolBox.height>this.boxHeight&&(e=this.boxHeight-this.toolBox.height),e<0&&(e=0),this.toolBoxPosition.x=i,this.toolBoxPosition.y=e,n.style.left=i+"px",n.style.top=e+"px",h.clearRect(i,e,Math.abs(a),Math.abs(r)),this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((function(){s.cropPicture(!0)}),100)},resetToolBox:function(){this.toolBox.width<0&&(this.toolBox.boxMove.moveTo.x=this.toolBox.x-this.toolBox.width),this.toolBox.height<0&&(this.toolBox.boxMove.moveTo.y=this.toolBox.y-this.toolBox.height),this.toolBox.width=Math.abs(this.toolBox.width),this.toolBox.height=Math.abs(this.toolBox.height)},toolBoxMouseDown:function(t){t=t.changedTouches&&t.changedTouches[0]||t,console.log(t,"toolBoxMouseDown");var o=this.$refs["toolBoxControl"];this.toolBox.x=parseInt(o.style.left.split("px")[0]),this.toolBox.y=parseInt(o.style.top.split("px")[0]),this.toolBox.disable=!1,this.dropImg.active=!1,this.toolBox.boxMove.start={x:t.pageX,y:t.pageY}},toolBoxMouseMove:function(t){if(t=t.changedTouches&&t.changedTouches[0]||t,this.dropImg.active&&this.dropImgMove(t),!1===this.toolBox.disable&&!0===this.moveAble){var o=t.pageX-this.toolBox.boxMove.start.x,i=t.pageY-this.toolBox.boxMove.start.y,e=this.toolBox.x+o,s=this.toolBox.y+i;this.drawControlBox(this.toolBox.width,this.toolBox.height,e,s)}},toolBoxMouseLeave:function(){var t=this;this.toolBox.disable=!0,this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((function(){t.cropPicture(!0)}),100),this.resetToolBox()},toolBoxMouseUp:function(){this.toolBox.x=parseInt(this.toolBoxPosition.x),this.toolBox.y=parseInt(this.toolBoxPosition.y),this.toolBox.disable=!0,this.dropImg.active=!1,this.resetToolBox()},printImg:function(){var t=this;if(this.drawImg.img){var o=this.$refs["canvas"],i=o.getContext("2d");i.font="18px bold 黑体",i.fillStyle="#ff0",i.textAlign="center",i.textBaseline="middle",i.save(),i.clearRect(0,0,o.width,o.height),i.translate(this.drawImg.x+this.drawImg.width/2,this.drawImg.y+this.drawImg.height/2),i.rotate(this.rotateImg.angle*Math.PI/180),i.translate(-(this.drawImg.x+this.drawImg.width/2),-(this.drawImg.y+this.drawImg.height/2)),i.translate(this.drawImg.x,this.drawImg.y),i.scale(this.isFlipHorizontal?-1:1,this.isFlipVertically?-1:1),i.drawImage(this.drawImg.img,this.drawImg.sx,this.drawImg.sy,this.drawImg.swidth,this.drawImg.sheight,this.isFlipHorizontal?-this.drawImg.width:0,this.isFlipVertically?-this.drawImg.height:0,this.drawImg.width,this.drawImg.height),i.translate(-this.drawImg.x,this.drawImg.y),i.restore(),this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((function(){t.cropPicture(!0)}),100)}},dropImgOn:function(t){!0===this.imgMove&&(this.dropImg.active=!0,this.dropImg.params=Object(n["a"])({},this.drawImg),this.dropImg.pageX=t.pageX,this.dropImg.pageY=t.pageY)},dropImgOff:function(){var t=this;this.dropImg.active=!1,this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((function(){t.cropPicture(!0)}),100)},dropImgMove:function(t){if(this.dropImg.active&&this.drawImg.img){var o=Object(n["a"])({},this.drawImg);o.x=this.dropImg.params.x-(this.dropImg.pageX-t.pageX),o.y=this.dropImg.params.y-(this.dropImg.pageY-t.pageY),this.toolBoxOverflow||(o.x>this.toolBox.x&&(o.x=this.toolBox.x),o.x<this.toolBox.x+this.toolBox.width-o.width&&(o.x=this.toolBox.x+this.toolBox.width-o.width),o.y>this.toolBox.y&&(o.y=this.toolBox.y),o.y<this.toolBox.y+this.toolBox.height-o.height&&(o.y=this.toolBox.y+this.toolBox.height-o.height)),this.$set(this,"drawImg",o),this.printImg(),t.stopPropagation&&t.stopPropagation()}},scaleReset:function(){this.drawImg.width=this.drawImg.swidth,this.drawImg.height=this.drawImg.sheight,this.printImg()},scaleImgWheel:function(t){var o=this;if(this.drawImg.img&&!0===this.scaleAble){var i,e=t||window.event;if(e.wheelDelta?i=-e.wheelDelta/40:e.detail&&(i=e.detail),this.toolBoxOverflow){var s=50;this.drawImg.x=this.drawImg.width-9*i>s?this.drawImg.x+3*i:this.drawImg.x,this.drawImg.y=this.drawImg.width-9*i>s?this.drawImg.y+3*i:this.drawImg.y,this.drawImg.width=this.drawImg.width-9*i>s?this.drawImg.width-9*i:s,this.drawImg.height=this.drawImg.width/this.scaleImg.rate}else{var a=this.toolBox.width;this.drawImg.x=this.drawImg.width-9*i>a?this.drawImg.x+3*i:this.drawImg.x,this.drawImg.y=this.drawImg.width-9*i>a?this.drawImg.y+3*i:this.drawImg.y,(this.drawImg.x>this.toolBox.x||this.drawImg.x+this.drawImg.width<this.toolBox.x+this.toolBox.width||this.drawImg.width<=this.toolBox.width)&&(this.drawImg.x=this.toolBox.x),(this.drawImg.y>this.toolBox.y||this.drawImg.y+this.drawImg.height<this.toolBox.y+this.toolBox.height)&&(this.drawImg.y=this.toolBox.y),this.drawImg.width=this.drawImg.width-9*i>a?this.drawImg.width-9*i:a,this.drawImg.height=this.drawImg.width/this.scaleImg.rate}this.printImg(),this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((function(){o.cropPicture(!0)}),100)}return t.preventDefault(),t.returnValue=!1,!1},flipHorizontal:function(){this.drawImg.img&&(0==this.isFlipHorizontal?this.isFlipHorizontal=!0:this.isFlipHorizontal=!1,this.printImg())},flipVertically:function(){this.drawImg.img&&(0==this.isFlipVertically?this.isFlipVertically=!0:this.isFlipVertically=!1,this.printImg())},turnImg:function(t){var o=this.rotateImg.angle,i=o+t;i>=-180&&i<=180&&(this.rotateImg.angle=i,this.rotateControl.position=i/180*100+100,this.printImg("rotate"))},turnReset:function(){this.rotateImg.angle=0,this.rotateControl.position=100,this.printImg("rotate")},controlBtnMouseDown:function(t,o){t=t.changedTouches&&t.changedTouches[0]||t,this.controlBox.disable=!1,this.controlBox.btnName=o,this.controlBox.start.x=t.clientX,this.controlBox.start.y=t.clientY,this.controlBox.start.width=this.toolBox.width,this.controlBox.start.height=this.toolBox.height,t.stopPropagation&&t.stopPropagation()},controlBtnMouseUp:function(t){this.controlBox.disable=!0,this.dropImgOff(),this.resetToolBox(),this.toolBoxMouseUp(),t.stopPropagation&&t.stopPropagation()},controlBtnMouseMove:function(t){if(t=t.changedTouches&&t.changedTouches[0]||t,!1===this.controlBox.disable){var o,i,e=t.clientX-this.controlBox.start.x,s=t.clientY-this.controlBox.start.y;if("leftUp"==this.controlBox.btnName){if(this.rate){var a=this.rate.split(":")[0]/this.rate.split(":")[1];a>=1?(o=this.toolBox.x+e,i=this.toolBox.y+e/a):(o=this.toolBox.x+s*a,i=this.toolBox.y+s)}else o=this.toolBox.x+e,i=this.toolBox.y+s;this.toolBox.width=this.controlBox.start.width-e,this.toolBox.height=this.controlBox.start.height-s}if("rightUp"==this.controlBox.btnName){if(this.rate){var r=this.rate.split(":")[0]/this.rate.split(":")[1];r>=1?(o=this.toolBox.x,i=this.toolBox.y-e/r):(o=this.toolBox.x,i=this.toolBox.y+s)}else o=this.toolBox.x,i=this.toolBox.y+s;this.toolBox.width=this.controlBox.start.width+e,this.toolBox.height=this.controlBox.start.height-s}if("rightDown"==this.controlBox.btnName&&(o=this.toolBox.x,i=this.toolBox.y,this.toolBox.width=this.controlBox.start.width+e,this.toolBox.height=this.controlBox.start.height+s),"leftDown"==this.controlBox.btnName){if(this.rate){var n=this.rate.split(":")[0]/this.rate.split(":")[1];n>=1?(o=this.toolBox.x+e,i=this.toolBox.y):(o=this.toolBox.x+-s*n,i=this.toolBox.y)}else o=this.toolBox.x+e,i=this.toolBox.y;this.toolBox.width=this.controlBox.start.width-e,this.toolBox.height=this.controlBox.start.height+s}"topCenter"==this.controlBox.btnName&&(o=this.toolBox.x,i=this.toolBox.y+s,this.toolBox.width=this.controlBox.start.width,this.toolBox.height=this.controlBox.start.height-s),"downCenter"==this.controlBox.btnName&&(o=this.toolBox.x,i=this.toolBox.y,this.toolBox.width=this.controlBox.start.width,this.toolBox.height=this.controlBox.start.height+s),"leftCenter"==this.controlBox.btnName&&(o=this.toolBox.x+e,i=this.toolBox.y,this.toolBox.width=this.controlBox.start.width-e,this.toolBox.height=this.controlBox.start.height),"rightCenter"==this.controlBox.btnName&&(o=this.toolBox.x,i=this.toolBox.y,this.toolBox.width=this.controlBox.start.width+e,this.toolBox.height=this.controlBox.start.height),this.drawControlBox(this.toolBox.width,this.toolBox.height,o,i)}t.stopPropagation&&t.stopPropagation()},changeFileName:function(t,o){var i=t.lastIndexOf(".");return t.substr(0,i+1)+("jpeg"===o?"jpg":o)},cropPicture:function(t){var o=this;if(this.drawImg.img){var i=this.$refs["canvas"];if(this.WatermarkText&&!t){var e=i.getContext("2d");e.font=this.WatermarkTextFont,e.fillStyle=this.WatermarkTextColor,e.textAlign="right",e.textBaseline="bottom",e.fillText(this.WatermarkText,this.toolBox.x+this.toolBox.width*this.WatermarkTextX,this.toolBox.y+this.toolBox.height*this.WatermarkTextY)}var s=new Image;!0===this.crossOrigin&&(s.crossOrigin=this.crossOriginHeader),s.src=i.toDataURL("image/".concat(this.fileType)),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,s){window.atob?setTimeout((function(){for(var a,r=atob(i.toDataURL(e,s).split(",")[1]),n=r.length,l=new Uint8Array(n),h=0;h<n;h++)l[h]=r.charCodeAt(h);try{a=new Blob([l],{type:"image/".concat(o.fileType)})}catch(g){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"TypeError"==g.name&&window.BlobBuilder){var d=window.BlobBuilder,c=new d;c.append(l.buffer),a=c.getBlob("image/".concat(o.fileType))}"InvalidStateError"==g.name&&(a=new Blob([l.buffer],{type:"image/".concat(o.fileType)}))}t(a)}),200):t(!1,{type:"image/".concat(o.fileType)})}}),i.toBlob((function(i){if(i){var e=new FileReader;e.readAsDataURL(i),e.onload=function(){var i=setInterval((function(){if(2==e.readyState){clearInterval(i);var a=document.createElement("canvas"),r=a.getContext("2d");if(1==o.originalGraph){var n=o.drawImg.width/o.drawImg.swidth,l=o.toolBox.width/n,h=o.toolBox.height/n;a.width=l,a.height=h;var d=(o.toolBox.x-o.drawImg.x)/n,c=(o.toolBox.y-o.drawImg.y)/n,g=o.drawImg.swidth,m=o.drawImg.sheight;r.translate(-d,-c),r.drawImage(o.drawImg.img,0,0,g,m)}else{a.width=o.toolBox.width,a.height=o.toolBox.height;var u=o.toolBox;if(o.rate){var x=o.rate.split(":")[0]/o.rate.split(":")[1],w=o.rate.split(":")[0],f=o.rate.split(":")[1];w>=f?r.drawImage(s,u.x,u.y,u.width,u.width*x,0,0,u.width,u.width*x):r.drawImage(s,u.x,u.y,u.width,u.width/x,0,0,u.width,u.width/x)}else r.drawImage(s,u.x,u.y,u.width,u.height,0,0,u.width,u.height)}a.toBlob((function(i){var e=o.changeFileName(o.fileName,o.fileType);t?o.previewMode&&o.$emit("onPrintImg",{index:o.index,fileName:e,blob:i,file:o.dataURLtoFile(a.toDataURL("image/".concat(o.fileType)),e),dataURL:a.toDataURL("image/".concat(o.fileType))}):(o.handleClose(),o.$emit("cutDown",{index:o.index,fileName:e,blob:i,file:o.dataURLtoFile(a.toDataURL("image/".concat(o.fileType)),e),dataURL:a.toDataURL("image/".concat(o.fileType))}))}),"image/".concat(o.fileType),.95)}}),200)}}else{var a=document.createElement("canvas");a.width=o.toolBox.width,a.height=o.toolBox.height;var r=a.getContext("2d"),n=o.toolBox;if(o.rate){var l=o.rate.split(":")[0]/o.rate.split(":")[1];r.drawImage(s,n.x,n.y,n.width,n.width*l,0,0,n.width,n.width*l)}else r.drawImage(s,n.x,n.y,n.width,n.height,0,0,n.width,n.height);var h=o.changeFileName(o.fileName,o.fileType);t?o.$emit("onPrintImg",{fileName:h,dataURL:a.toDataURL("image/".concat(o.fileType))}):(o.handleClose(),o.$emit("cutDown",{fileName:h,dataURL:a.toDataURL("image/".concat(o.fileType))}))}})),"image/".concat(o.fileType)}else t||(console.warn("No picture selected"),o.$emit("error",{err:1,msg:"No picture selected"}))},scrollBarControlMove:function(t){if(this.rotateControl.active){var o=t.pageX-this.rotateControl.start.x,i=this.rotateControl.start.position+o;i<=0&&(i=0),i>=200&&(i=200),this.rotateControl.position=i,this.rotateImg.angle=(i-100)/100*180,this.printImg()}},scrollBarControlOn:function(t){this.rotateControl.active=!0,this.rotateControl.start.x=t.pageX,this.rotateControl.start.y=t.pageY,this.rotateControl.start.position=this.rotateControl.position},scrollBarControlOff:function(){this.rotateControl.active=!1}}}),d=h,c=(i("a777"),i("2877")),g=Object(c["a"])(d,a,r,!1,null,"20ae909b",null),m=g.exports,u=function(t){if(t&&t.succ){if(void 0==t.file)return t.succ(null);t.targetSize=t.hasOwnProperty("targetSize")?t.targetSize:-1,t.fileName=t.hasOwnProperty("fileName")?t.fileName:"image",t.quality=t.hasOwnProperty("quality")?t.quality:.92;var o="image/jpeg";if(-1==o.indexOf("image"))return t.err("请选择图片文件^_^");var i=t.file.size;if(t.targetSize>i)return t.succ(t.file);w(t.file,(function(i){if(i){var e=new Image;e.src=i,e.onload=function(){var i=this.width/this.height,s=document.createElement("canvas"),a=s.getContext("2d");t.width?(s.width=t.width,s.height=parseInt(t.width/i)):t.height?(s.width=parseInt(t.height*i),s.height=t.height):(s.width=this.width,s.height=this.height),a.drawImage(e,0,0,s.width,s.height);var r=s.toDataURL(o,t.quality),n=x(r,t.fileName);if(-1!=t.targetSize&&t.targetSize<n.size)return t.err("图片上传尺寸太大，请重新上传^_^");t.succ(n)}}}))}},x=function(t,o){var i=t.split(","),e=i[0].match(/:(.*?);/)[1],s=atob(i[1]),a=s.length,r=new Uint8Array(a);while(a--)r[a]=s.charCodeAt(a);return new File([r],o,{type:e})};function w(t,o){var i=new FileReader;if(void 0==t)return o(null);i.readAsDataURL(t),i.onload=function(){var t=this.result;o(t)}}var f=i("7a94").fabric,B={data:function(){return{cutWidth:200,cutHeight:200,boxWidth:document.documentElement.clientWidth-30,boxHeight:document.documentElement.clientHeight-90,screenHeight:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,screenWidth:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,visible:!1,rotateImg:{angle:0},showImg:"",drawImg:{x:0,y:0,img:"",width:"",height:""},testImage:"",result_time:0}},components:{ImgCutter:m},mounted:function(){},watch:{visible:function(t){var o=this;t&&(this.rotateImg.angle=0,this.testImage="",this.fabricCanvas||(console.log("初始化fabric"),this.$nextTick((function(){o.fabricCanvas=new f.Canvas("rotate-canvas"),f.Object.prototype.transparentCorners=!1}))))}},methods:{confirm:function(){var t=this,o=document.createElement("img");o.src=this.showImg,o.crossOrigin="anonymous",o.onload=function(){t.drawImg.img=o,t.drawImg.width=o.width,t.drawImg.height=o.height,t.printImg()}},confirmClick:function(){if(this.testImage){var t=x(this.testImage,this.fileName);this.uploadImage(t)}},gettime:function(){var t=Date.now(),o=new Date(t),i=(o.getFullYear(),o.getMonth()+1);i=i<10?"0"+i:i;var e=o.getDate();e=e<10?"0"+e:e;var s=o.getHours();s=s<10?"0"+s:s;var a=o.getMinutes();a=a<10?"0"+a:a;var r=o.getSeconds();r=r<10?"0"+r:r,this.result_time=s+a+r},rotateImage:function(){this.rotateImg.angle+=90,this.printImg()},putImgToCanv:function(t){var o=this;if(t){this.fileName=t.name;var i=new FileReader;i.readAsDataURL(t),i.onload=function(t){var i=t.target.result;o.showImg=i,o.confirm()}}},printImg:function(){if(this.drawImg.img){this.fabricCanvas.clear();var t=new f.Image(this.drawImg.img,{centeredRotation:!0}),o=this.rotateImg.angle%360,i=this.screenHeight/this.drawImg.height;i*this.drawImg.width>this.screenHeight&&(i=this.screenHeight/this.drawImg.width),t.rotate(o),t.scale(i),t.set("selectable",!1),this.fabricCanvas.add(t),t.center(),t.setCoords(),this.fabricCanvas.requestRenderAll();var e=t.toDataURL({enableRetinaScaling:!0});this.testImage=e}},onClose:function(){this.visible=!1},onChooseImg:function(t){console.log(t,"onChooseImg")},cutDown:function(t){console.log(t.file,"curDown"),this.fileChange(t.file)},fileChange:function(t){var o=this,i=t.target.files[0];i&&(this.fileName=i.name,u({file:i,fileName:i.name,quality:.9,height:1024,succ:function(t){o.visible=!0,o.putImgToCanv(t)},err:function(){}}))},uploadImage:function(t){var o=this;this.gettime(),this.$service.ossUpload(t).then((function(t){t.url&&(o.visible=!1,o.$service.addRoom({name:"我的设计"+o.result_time,image:t.url,areas:[]}).then((function(t){t.id&&o.$router.push("/design?id="+t.id+"&back=mydesign&mode=edit")})).catch((function(t){})))}))}}},p=B,v=(i("c42a"),Object(c["a"])(p,e,s,!1,null,null,null));o["a"]=v.exports},dc91:function(t,o,i){}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9ee3b1ae"],{1:function(t,e){},1166:function(t,e,i){},"12f8":function(t,e,i){"use strict";i("4b8a")},1529:function(t,e,i){"use strict";i("afe1")},"1b09":function(t,e,i){"use strict";i("6509")},"1d26":function(t,e,i){},"1fe8":function(t,e,i){},2:function(t,e){},2638:function(t,e,i){"use strict";i("1fe8")},"26fd":function(t,e,i){"use strict";i("a5ea")},3:function(t,e){},"31d9":function(t,e,i){},"354c":function(t,e,i){"use strict";i("31d9")},"3cd0":function(t,e,i){"use strict";i("7b25")},"447a":function(t,e,i){"use strict";i("91a0")},"4b8a":function(t,e,i){},5651:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"design-layout"},[t.loading?i("a-spin",{attrs:{spinning:t.loading}}):t._e(),[i("layout-top",{ref:"top",attrs:{from:t.from},on:{previewImage:t.previewImage,goDetail:t.goDetail}}),i("layout-preview2",{ref:"canvasWrap",attrs:{id:t.id},on:{click:t.hideBottomClick}}),i("layout-edit",{directives:[{name:"show",rawName:"v-show",value:t.showEdit,expression:"showEdit"}],ref:"editWrap",attrs:{id:t.id}}),i("layout-bottom",{directives:[{name:"show",rawName:"v-show",value:!t.hideBottom,expression:"!hideBottom"}]})]],2)},n=[],s=i("1da1"),o=(i("96cf"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.showTop,expression:"showTop"}],staticClass:"design-layout-top",style:{background:t.show?"rgba(255, 255, 255, .65)!important":"rgba(255, 255, 255, 0)!important"}},[i("h4",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}]},[t._v(t._s(t.name))]),i("l-header",{attrs:{backType:"back"}}),i("div",{staticClass:"design-layout-top-right flex-box",staticStyle:{top:"0.1rem",right:"0.5rem"}},[t.canEdit?i("div",{staticClass:"design-layout-top-op"},[i("a-icon",{directives:[{name:"show",rawName:"v-show",value:t.canEdit,expression:"canEdit"}],attrs:{type:"edit",theme:"filled"},on:{click:t.showTools}})],1):t._e(),i("div",{staticClass:"design-layout-top-op"},[i("a-icon",{attrs:{type:"setting",theme:t.ShowYuntools?"twoTone":"filled"},on:{click:t.Yuntools}}),i("a-icon",{attrs:{type:"delete",theme:"filled"},on:{click:t.reset}}),i("a-icon",{attrs:{type:"eye",theme:"filled"},on:{click:t.previewImage}})],1)])],1)}),r=[],c=i("ade3"),l=(i("b0c0"),i("ac1f"),i("5319"),i("9340")),h=Object(c["a"])({name:"design-top",props:{from:String},data:function(){return{show:!1,selecedstatus:!1,ShowYuntools:!1,showTop:"edit"!==this.$route.query.mode,back:this.$route.query.back,canEdit:"undefined"!==this.$route.query.canEdit,name:""}},components:{lHeader:l["a"]},watch:{rommInfo:{handler:function(t){if("{}"!==JSON.stringify(t))if(this.canEdit){var e=this.rommInfo;this.name=e.customer_name+e.customer_mobile||e.created_at.replace(/-|:|\s+/g,"")}else this.name=this.rommInfo.name},immediate:!0}},computed:{rommInfo:function(){return this.$store.state.user.roomInfo}},created:function(){var t=this;this.$parent.$on("toggleBottom",(function(e){t.show=e})),this.$parent.$on("showTop",(function(e){t.showTop=e})),this.$parent.$on("showEdit",(function(e){t.showTop=!e})),this.$parent.$on("selecedstatus",(function(e){t.selecedstatus=e})),this.$parent.$on("showBorder2",(function(e){t.show=!t.show})),this.$parent.$on("showBorder",(function(e){t.show=!0}))},mounted:function(){},methods:{Yuntools:function(){this.ShowYuntools=!this.ShowYuntools,this.$parent.$emit("ShowYuntools")},reset:function(){this.$parent.$emit("reset")},deleteSelected:function(){this.$parent.$emit("deleteSelected")},previewImage:function(){this.$emit("previewImage")},showTools:function(){this.showTop=!1,this.showBottom=!1,this.$parent.$emit("showEdit",!0)}}},"mounted",(function(){})),d=h,u=(i("3cd0"),i("2877")),m=Object(u["a"])(d,o,r,!1,null,"0a435016",null),f=m.exports,p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"design-layout-bottom",class:{hide:!t.showBottom||!t.showme}},[i("i",{staticClass:"iconfont icon-down rotate circle",class:{hide:t.showBottom||!t.showme},on:{click:t.toggle}},[i("i",{staticClass:"iconfont icon-down rotate2"})]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.parentTag,expression:"parentTag"}],staticClass:"design-layout-b-h1 flex-box",staticStyle:{"font-weight":"bold","border-top":"1px solid rgba(130, 130, 130, 0.09)",width:"100%"}},[i("div",{staticClass:"design-layout-b-h1-tl flex-box"},t._l(t.scnery,(function(e,a){return i("div",{key:a,staticClass:"tl-tag0",class:{selected:t.selected.scneryId===e.id},on:{click:function(i){return t.toggleScnery(e)}}},[t._v(" "+t._s(e.name)+" ")])})),0),this.selected&&this.PathSelectStatus&&1===this.selected.content.parent_category_id&&this.selected.content.zijian_product_id>0?i("a-button",{staticClass:"curtain-btn",attrs:{type:"danger",size:"small"},on:{click:t.dapeiClick}},[t._v("窗帘搭配工具")]):t._e()],1),i("div",{staticClass:"design-layout-b-h2",style:{borderTop:t.parentTag?"":"1px solid rgba(130, 130, 130, 0.09)"}},[i("a-button",{staticStyle:{"font-size":"0.11rem","font-weight":"bold","background-color":"rgba(255, 0, 0, 0.8)","border-color":"rgba(255, 0, 0, 0.8)",width:"0.8rem",float:"left",margin:"0.052rem 0rem 0rem",padding:"0px","line-height":"0.25rem",height:".25rem"},attrs:{type:"primary",icon:"menu-unfold",size:"small"},on:{click:function(e){return t.parentTagshow()}}},[t._v(" "+t._s(t.parentTag?"收起分类":this.parentTagName?this.parentTagName:"墙布")+" ")]),i("div",{staticClass:"design-layout-sucai-tl flex-box",style:{width:t.screenWidth-130+"px",float:"right"}},t._l(t.getCurMaterialTitles,(function(e,a){return i("div",{directives:[{name:"show",rawName:"v-show",value:t.getCurMaterialTitles.length>1,expression:"getCurMaterialTitles.length >1"}],key:a,staticClass:"tl-tag",class:{selected:t.selected.materialId===e.id},on:{click:function(i){return t.toggleMaterialTitle(e)}}},[t._v(" "+t._s(e.name)+" ")])})),0),i("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.getMaterial,expression:"getMaterial"}],ref:"sucaiList",staticClass:"design-layout-sucai-content",attrs:{"infinite-scroll-disabled":t.loading,"infinite-scroll-distance":20}},t._l(t.activeMaterial,(function(e,a){return i("div",{key:a,staticClass:"design-layout-sucai-ls flex-box",class:{selected:t.selected.content.id===e.id,isLian:2!==t.selected.scneryId},style:{width:2===t.selected.scneryId?"0.5rem":"0.7rem"},on:{click:function(i){return t.contentClick(e,a)}}},[i("div",{staticClass:"sucai-wrap"},[i("div",{directives:[{name:"lazy",rawName:"v-lazy:background-image",value:e.image+"?x-oss-process=image/resize,m_mfit,h_100",expression:"item.image+'?x-oss-process=image/resize,m_mfit,h_100'",arg:"background-image"}],staticClass:"sucai-wrap-img",style:{"background-position":"center center","background-repeat":2===t.selected.scneryId?"":"no-repeat"}},[i("img",{ref:"img"+a,refInFor:!0,staticStyle:{opacity:"0"},attrs:{crossOrigin:"Anonymous",src:e.image+"?x-oss-process=image/resize,m_mfit,h_100"}})])]),i("span",[t._v(t._s(e.name))])])})),0),t.loading&&!t.finished?i("div",{staticClass:"demo-loading-container"},[i("a-spin")],1):t._e()],1),i("preview-curtain",{ref:"curtain",attrs:{productId:t.selectedProductId},model:{value:t.prewVisible,callback:function(e){t.prewVisible=e},expression:"prewVisible"}})],1)},g=[],v=(i("7db0"),i("99af"),i("a9e3"),i("487a")),w=i.n(v),y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a-modal",{staticClass:"preview-modal",attrs:{width:t.screenWidth+"px",height:"100vh",zIndex:1e7,mask:!1,visible:t.prewVisible,fullScreen:!0,closeIcon:t.type="关闭预览",footer:null,title:"窗帘搭配预览"},on:{cancel:t.cancel}},[i("div",{staticClass:"design-layout-top-op2"},[i("a-button",{staticClass:"comfirm_but",attrs:{type:"primary",size:"small"},on:{click:t.handlcomfirm}},[t._v("确定提交")])],1),i("div",{staticClass:"flex-box modal_body"},[i("div",{staticClass:"preview_curtain_content"},[i("div",{staticClass:"preview_curtain_top"},[i("div",{staticClass:"preview_curtain_img"},[i("canvas",{staticClass:"preview-canvas",attrs:{id:"canvasCurtain"}}),i("div",{ref:"previewImg",staticClass:"preview-img",style:{width:t.preview.width,height:t.preview.height,"background-image":"url("+this.selected.sha.image+")"},attrs:{id:"kkk"}},[i("div",{staticClass:"curtain-wrap-item left-item"},[t._l(6,(function(e){return i("img",{staticClass:"editColum",staticStyle:{transform:"rotateY(180deg)","margin-left":"-0.7px"},attrs:{src:t.selectedCurtainList[0].image},on:{click:function(e){return t.editCurtain(0)}}})})),t._l(2,(function(e){return i("img",{staticClass:"editColum",staticStyle:{transform:"rotateY(180deg)","margin-left":"-0.6px"},attrs:{src:t.selectedCurtainList[1].image},on:{click:function(e){return t.editCurtain(1)}}})})),t._l(2,(function(e){return i("img",{staticClass:"editColum",staticStyle:{transform:"rotateY(180deg)","margin-left":"-0.6px"},attrs:{src:t.selectedCurtainList[2].image},on:{click:function(e){return t.editCurtain(2)}}})}))],2),i("div",{staticClass:"curtain-wrap-item  right-item"},[t._l(2,(function(e){return i("img",{staticClass:"editColum",staticStyle:{"margin-right":"-0.7px"},attrs:{src:t.selectedCurtainList[2].image},on:{click:function(e){return t.editCurtain(2)}}})})),t._l(2,(function(e){return i("img",{staticClass:"editColum",staticStyle:{"margin-right":"-0.7px"},attrs:{src:t.selectedCurtainList[1].image},on:{click:function(e){return t.editCurtain(1)}}})})),t._l(6,(function(e){return i("img",{staticClass:"editColum",staticStyle:{"margin-right":"-0.7px"},attrs:{src:t.selectedCurtainList[0].image},on:{click:function(e){return t.editCurtain(0)}}})}))],2)])]),i("div",{staticClass:"preview_curtain_from"},[i("div",[i("a-radio-group",{staticClass:"ping",on:{change:t.onChange},model:{value:t.checkRadio,callback:function(e){t.checkRadio=e},expression:"checkRadio"}},[i("a-radio",{staticClass:"ping_radio",attrs:{value:0}},[t._v("单拼")]),i("a-radio",{staticClass:"ping_radio",attrs:{value:1}},[t._v("双拼")]),i("a-radio",{staticClass:"ping_radio",attrs:{value:2}},[t._v("三拼")])],1)],1),i("div",{staticClass:"reset_but_area"},[i("a-button",{directives:[{name:"show",rawName:"v-show",value:t.checkRadio>=0,expression:"checkRadio >= 0"}],staticClass:"reset_but",on:{click:function(e){return t.reset(1)}}},[t._v("重置1")]),i("a-button",{directives:[{name:"show",rawName:"v-show",value:t.checkRadio>=1,expression:"checkRadio >= 1"}],staticClass:"reset_but",on:{click:function(e){return t.reset(2)}}},[t._v("重置2")]),i("a-button",{directives:[{name:"show",rawName:"v-show",value:t.checkRadio>=2,expression:"checkRadio >= 2"}],staticClass:"reset_but",on:{click:function(e){return t.reset(3)}}},[t._v("重置3")])],1)])]),i("div",{staticClass:"preview_curtain_bottom"},[i("div",{staticClass:"design-layout-sucai-tl flex-box"},t._l(t.tags,(function(e,a){return i("div",{key:a,staticClass:"tl-tag",class:{selected:t.selected.materialId===e.id},on:{click:function(i){return t.toggleMaterialTitle(e)}}},[t._v(" "+t._s(e.name)+" ")])})),0),i("div",{ref:"curtainBottom",staticClass:"preview_curtain_bottom_main",on:{scroll:t.onScroll}},[i("div",{staticClass:"img_ul"},t._l(t.relationProductList,(function(e,a){return i("div",{key:a,staticClass:"img_li"},[i("div",{staticClass:"img_areaa",style:{background:"url("+e.image+") left center",width:t.screenHeight/4+"px",height:t.screenHeight/8+"px"},on:{click:function(i){return t.handlerselectedCurtain(e)}}}),i("span",{staticClass:"img-bottom-text"},[t._v(t._s(e.name))])])})),0)])])])])])},b=[],C=i("2909"),x=(i("159b"),i("a630"),i("3ca3"),i("c0e9")),_=i.n(x),k=(i("466d"),{IsPC:function(){for(var t=navigator.userAgent,e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],i=!0,a=0;a<e.length;a++)if(t.indexOf(e[a])>0){i=!1;break}return i},browser:{versions:function(){var t=navigator.userAgent;navigator.appVersion;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&-1==t.indexOf("KHTML"),mobile:!!t.match(/AppleWebKit.*Mobile/i)||!!t.match(/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:-1==t.indexOf("Safari")}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()}}),A={props:{value:Boolean,productId:Number},data:function(){return{loading:!1,checkRadio:0,defaultCheckRadio:0,prewVisible:!1,tags:[{name:"布料",id:1},{name:"纱",id:2}],selected:{materialId:1,sha:{image:"https://debake.oss-cn-shanghai.aliyuncs.com/app/images/2110/28/bb0a779ae159a6ff60da9c7ffbe8e88d.png"}},id:this.$route.query.id,finished:!1,limit:15,page:1,relationProductList:[],preview:{width:"6.5rem",height:"4.1rem"},screenHeight:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,screenWidth:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,selectedCurtainList:[{},{},{}],clickArea:"",defaultCurtain:{}}},watch:{value:function(t){var e=this;this.prewVisible=t,t&&this.$nextTick((function(){var t=e.$refs.previewImg;if(t){var i=t.getElementsByTagName("img");Array.from(i).forEach((function(e){e.style.width=.025*t.offsetWidth+"px"}))}}))},prewVisible:function(t){this.$emit("input",t)}},computed:{bottomHeight:function(){return k.IsPC()?"1.4rem":".9rem"},editCurtainData:function(){return this.$store.state.curtainImageData.editCurtainData}},created:function(){(this.screenHeight>900||this.screenWidth>1500)&&(this.limit=25)},methods:{scrollStart:function(){this.$refs.curtainBottom.scrollLeft=0},toggleMaterialTitle:function(t){this.scrollStart(),this.selected.materialId=t.id,this.getMaterial(!0)},initData:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.clickArea="",t.getStoreDefaultData=t.editCurtainData[t.productId],e.next=4,t.$service.chuanglianList({product_id:t.productId});case 4:i=e.sent,i.data&&i.data.length>0&&(t.defaultCurtain=i.data[0]),t.getStoreDefaultData?(t.checkRadio=t.getStoreDefaultData.checkRadio,t.selectedCurtainList=t.getStoreDefaultData.selectedCurtainList):Number(t.defaultCurtain.peibu2_product_id)?(t.checkRadio=2,t.defaultCheckRadio=2,t.selectedCurtainList[2]=t.defaultCurtain.peibu2,t.selectedCurtainList[1]=t.defaultCurtain.peibu1,t.selectedCurtainList[0]=t.defaultCurtain.zijian):Number(t.defaultCurtain.peibu1_product_id)?(t.checkRadio=1,t.defaultCheckRadio=1,t.selectedCurtainList[2]=t.defaultCurtain.peibu1,t.selectedCurtainList[1]=t.defaultCurtain.zijian,t.selectedCurtainList[0]=t.defaultCurtain.zijian):(t.checkRadio=0,t.defaultCheckRadio=0,t.selectedCurtainList[2]=t.defaultCurtain.zijian,t.selectedCurtainList[1]=t.defaultCurtain.zijian,t.selectedCurtainList[0]=t.defaultCurtain.zijian),t.getMaterial("refresh");case 8:case"end":return e.stop()}}),e)})))()},handlcomfirm:function(){var t=this;this.prewVisible=!1,console.log("哈哈哈"),_()(document.querySelector("#kkk"),{useCORS:!0}).then((function(e){var i=e.toDataURL("image/jpeg",.7),a=i;t.$store.commit("SET_BASE64",a),t.$parent.$parent.$refs.canvasWrap.putCurtainImg(),console.log("哈哈哈2")})),this.$store.commit("SET_EDITCURTAINDATA",{id:this.productId,data:{checkRadio:this.checkRadio,selectedCurtainList:[].concat(Object(C["a"])(this.selectedCurtainList),[this.selected.sha])}})},reset:function(t){0==this.checkRadio&&1==t&&(this.$set(this.selectedCurtainList,2,this.defaultCurtain.zijian),this.$set(this.selectedCurtainList,1,this.defaultCurtain.zijian),this.$set(this.selectedCurtainList,0,this.defaultCurtain.zijian)),1==this.checkRadio&&1==t&&(0===this.defaultCheckRadio?this.$set(this.selectedCurtainList,2,this.defaultCurtain.zijian):1===this.defaultCheckRadio?this.$set(this.selectedCurtainList,2,this.defaultCurtain.peibu1):2===this.defaultCheckRadio&&this.$set(this.selectedCurtainList,2,this.defaultCurtain.peibu2)),1==this.checkRadio&&2==t&&(0===this.defaultCheckRadio||1===this.defaultCheckRadio?(this.$set(this.selectedCurtainList,1,this.defaultCurtain.zijian),this.$set(this.selectedCurtainList,0,this.defaultCurtain.zijian)):2===this.defaultCheckRadio&&(this.$set(this.selectedCurtainList,1,this.defaultCurtain.peibu1),this.$set(this.selectedCurtainList,0,this.defaultCurtain.zijian))),2==this.checkRadio&&1==t&&(0===this.defaultCheckRadio?this.$set(this.selectedCurtainList,2,this.defaultCurtain.zijian):1===this.defaultCheckRadio?this.$set(this.selectedCurtainList,2,this.defaultCurtain.peibu1):2===this.defaultCheckRadio&&this.$set(this.selectedCurtainList,2,this.defaultCurtain.peibu2)),2==this.checkRadio&&2==t&&(0===this.defaultCheckRadio||1===this.defaultCheckRadio?this.$set(this.selectedCurtainList,1,this.defaultCurtain.zijian):2===this.defaultCheckRadio&&this.$set(this.selectedCurtainList,1,this.defaultCurtain.peibu1)),2==this.checkRadio&&3==t&&this.$set(this.selectedCurtainList,0,this.defaultCurtain.zijian)},editCurtain:function(t){this.clickArea=t},onChange:function(t){console.log("radio checked",t.target.value)},handlerselectedCurtain:function(t){if(1==this.selected.materialId){if(""===this.clickArea)return void this.$message.info("请选择要编辑的窗帘区域");2==this.checkRadio?this.$set(this.selectedCurtainList,this.clickArea,t):1==this.checkRadio?2==this.clickArea?this.$set(this.selectedCurtainList,2,t):(this.$set(this.selectedCurtainList,0,t),this.$set(this.selectedCurtainList,1,t)):0==this.checkRadio&&(this.$set(this.selectedCurtainList,0,t),this.$set(this.selectedCurtainList,1,t),this.$set(this.selectedCurtainList,2,t))}else this.selected.sha=t},cancel:function(){this.prewVisible=!1},onScroll:function(t){var e=t.target;e.scrollLeft>=e.scrollWidth-e.offsetWidth-20&&this.getMaterial()},getMaterial:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function i(){var a,n;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(e.productId){i.next=2;break}return i.abrupt("return");case 2:if(t&&(e.page=1,e.finished=!1),!e.loading&&!e.finished){i.next=5;break}return i.abrupt("return");case 5:return e.loading=!0,e.$message.loading({content:"加载中..."}),a="",a=1==e.selected.materialId?"relationList":"chuanglianshaList",i.next=11,e.$service[a]({page:e.page,per_page:e.limit,product_id:e.productId});case 11:n=i.sent,e.$message.destroy(),e.loading=!1,e.relationProductList=t?n.data:e.relationProductList.concat(n.data),e.finished=n.data.length!==e.limit,e.page=e.page+1;case 17:case"end":return i.stop()}}),i)})))()}}},$=A,I=(i("12f8"),i("85a8"),Object(u["a"])($,y,b,!1,null,"3c3c0be3",null)),S=I.exports,P={components:{previewCurtain:S},data:function(){return{prewVisible:!1,parentTag:!0,parentTagName:"",IsPC:k.IsPC,id:this.$route.query.id,finished:!1,limit:15,page:1,loading:!1,showBottom:"edit"!==this.$route.query.mode,showme:"edit"!==this.$route.query.mode,showBorderme:"edit"!==this.$route.query.mode,showBorderme2:"edit"!==this.$route.query.mode,PathSelectStatus:!1,activeMaterial:[],screenHeight:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,screenWidth:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,selected:{scneryId:"",materialId:"",content:{}},scnery:[],selectedProductId:0}},directives:{infiniteScroll:w.a},created:function(){var t=this;(this.screenHeight>900||this.screenWidth>1500)&&(this.limit=25),this.getData(),this.showBottom=!this.showBottom,this.$parent.$on("showEdit",(function(e){t.showBottom=t.showme=!e})),this.$parent.$on("showBorder",(function(e){t.PathSelectStatus=!0,"edit"==t.$route.query.mode?t.showBottom=!e:t.showBottom=t.showBorderme})),this.$parent.$on("showBorder2",(function(e){t.showBottom=!t.showBottom,t.PathSelectStatus=!1}))},computed:{getCurMaterialTitles:function(){var t=this,e=this.scnery.find((function(e){return e.id==t.selected.scneryId}));return e&&e.children||[]},editCurtainData:function(){return this.$store.state.curtainImageData.editCurtainData}},methods:{scrollStart:function(){this.$refs.sucaiList.scrollLeft=0},getData:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$service.categoryTree({room_id:t.id});case 2:i=e.sent,t.scnery=i,t.scnery.length&&(t.selected.scneryId=t.scnery[0].id,t.scnery[0].children&&t.scnery[0].children.length&&(t.selected.materialId=t.scnery[0].children[0].id,t.getMaterial(!0)));case 5:case"end":return e.stop()}}),e)})))()},getMaterial:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function i(){var a;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(e.selected.scneryId&&e.selected.materialId){i.next=2;break}return i.abrupt("return");case 2:if(t&&(e.page=1,e.finished=!1),!e.loading){i.next=5;break}return i.abrupt("return");case 5:if(!e.finished){i.next=7;break}return i.abrupt("return");case 7:return e.loading=!0,i.next=10,e.$service.productList({parent_category_id:e.selected.scneryId,category_id:e.selected.materialId,room_id:e.id,page:e.page,per_page:e.limit});case 10:a=i.sent,e.loading=!1,(e.page=1)&&a.data.unshift({id:999,name:"装饰画",image:"https://debake.oss-cn-shanghai.aliyuncs.com/chuanglian_chengpin/fushengmeng/%E5%A4%9A%E7%91%99%E5%9B%9E%E5%BF%86.png",opacity:"1.00",is_support:1,parent_category_id:15,product_type:1}),e.activeMaterial=t?a.data:e.activeMaterial.concat(a.data),e.finished=a.data.length!==e.limit,e.page=e.page+1;case 16:case"end":return i.stop()}}),i)})))()},parentTagshow:function(){this.parentTag=!this.parentTag},toggleScnery:function(t){this.scrollStart(),this.selected.scneryId=t.id,this.selected.materialId=t.children&&t.children[0]&&t.children[0].id,this.getMaterial(!0),this.parentTagName=t.name,console.log(this.PathSelectStatus)},toggleMaterialTitle:function(t){this.scrollStart(),this.selected.materialId=t.id,this.getMaterial(!0)},dapeiClick:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.selected.content?(t.prewVisible=!0,t.$nextTick((function(){t.$refs.curtain.initData()}))):t.$message.info("请点击选区");case 1:case"end":return e.stop()}}),e)})))()},contentClick:function(t,e,i){this.selected.content=t,this.selectedProductId=t.id,Number(t.is_support)?(this.$store.commit("SET_EDITCURTAINDATA",{id:t.id,data:null}),this.editCurtainData,this.$parent.$emit("materialChange",this.selected)):this.$message.info("此产品不适用该场景")},toggle:function(){this.showBottom=!this.showBottom,this.$parent.$emit("toggleBottom",this.showBottom)}}},T=P,O=(i("a1e8"),Object(u["a"])(T,p,g,!1,null,"1ca05a16",null)),M=O.exports,L=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.showme,expression:"showme"}],staticClass:"layout-preview",style:t.preStyle,on:{click:function(e){return e.target!==e.currentTarget?null:(e.preventDefault(),t.shutdown())}}},[i("canvas",{ref:"cas",staticStyle:{display:"none"},attrs:{id:"cas"}}),i("canvas",{staticStyle:{display:"none"},attrs:{id:"cas1"}}),t._v(" "),i("canvas",{ref:"decr",staticStyle:{display:"none"},attrs:{id:"decr"}}),i("canvas",{ref:"myCanvas",attrs:{width:t.canvasWidth,height:t.canvasHeight,id:"myCanvas"}}),i("img",{staticClass:"test-image",staticStyle:{display:"none"},attrs:{src:t.testImage}}),i("preview-image",{attrs:{isLiked:t.isLiked,img:t.previewImg},on:{downLoadSuccess:t.downLoadSuccess,Like:t.Like,userOffer:t.userOffer},model:{value:t.prewVisible,callback:function(e){t.prewVisible=e},expression:"prewVisible"}}),i("zs-tools",{ref:"zsTools",on:{deleteImage:t.deleteImage,reset:t.resetImage,perspective:t.perspectiveImage}}),i("yun-tools",{directives:[{name:"show",rawName:"v-show",value:t.ShowYuntools,expression:"ShowYuntools"}]})],1)},R=[],E=i("5530");i("4de4"),i("d81d"),i("d3b7"),i("6062"),i("ddb0"),i("b680"),i("1276");var j=i("d4ec"),D=i("bee2"),z=(i("cb29"),function(){function t(e,i){if(Object(j["a"])(this,t),e&&e.strokeStyle&&i&&i.width&&i.height){var a=document.createElement("canvas");a.width=parseInt(i.width),a.height=parseInt(i.height);var n=a.getContext("2d");console.log(n,"ctxo"),n.drawImage(i,0,0,a.width,a.height);var s=document.createElement("canvas");s.width=e.canvas.width,s.height=e.canvas.height;var o=s.getContext("2d");this.p={ctxd:e,cvso:a,ctxo:n,ctxt:o}}}return Object(D["a"])(t,[{key:"draw",value:function(t){console.log(t,"points");for(var e=t[0][0],i=t[0][1],a=t[1][0],n=t[1][1],s=t[2][0],o=t[2][1],r=t[3][0],c=t[3][1],l=[Math.sqrt(Math.pow(e-a,2)+Math.pow(i-n,2)),Math.sqrt(Math.pow(a-s,2)+Math.pow(n-o,2)),Math.sqrt(Math.pow(s-r,2)+Math.pow(o-c,2)),Math.sqrt(Math.pow(r-e,2)+Math.pow(c-i,2))],h=this.p.cvso.width,d=this.p.cvso.height,u=0,m=0,f=0,p=0;p<4;p++){var g=0;g=p%2?l[p]/h:l[p]/d,g>m&&(u=p,m=g),0==l[p]&&f++}if(!(f>1)){var v=2,w=5*v,y=this.p.ctxo,b=this.p.ctxt;if(b.clearRect(0,0,b.canvas.width,b.canvas.height),u%2==0){var C=this.create_canvas_context(h,w);C.globalCompositeOperation="copy";for(var x=C.canvas,_=0;_<d;_+=v){var k=_/d,A=e+(r-e)*k,$=i+(c-i)*k,I=a+(s-a)*k,S=n+(o-n)*k,P=Math.atan((S-$)/(I-A)),T=Math.sqrt(Math.pow(I-A,2)+Math.pow(S-$,2))/h;C.setTransform(1,0,0,1,0,-_),C.drawImage(y.canvas,0,0),b.translate(A,$),b.rotate(P),b.scale(T,T),b.drawImage(x,0,0),b.setTransform(1,0,0,1,0,0)}}else if(u%2==1){C=this.create_canvas_context(w,d);C.globalCompositeOperation="copy";x=C.canvas;for(var O=0;O<h;O+=v){k=O/h,A=e+(a-e)*k,$=i+(n-i)*k,I=r+(s-r)*k,S=c+(o-c)*k,P=Math.atan((A-I)/(S-$)),T=Math.sqrt(Math.pow(I-A,2)+Math.pow(S-$,2))/d;C.setTransform(1,0,0,1,-O,0),C.drawImage(y.canvas,0,0),b.translate(A,$),b.rotate(P),b.scale(T,T),b.drawImage(x,0,0),b.setTransform(1,0,0,1,0,0)}}this.p.ctxd.save(),this.p.ctxd.drawImage(b.canvas,0,0),this._applyMask(this.p.ctxd,[[e,i],[a,n],[s,o],[r,c]]),this.p.ctxd.restore()}}},{key:"create_canvas_context",value:function(t,e){var i=document.createElement("canvas");i.width=t,i.height=e;var a=i.getContext("2d");return a}},{key:"_applyMask",value:function(t,e){t.beginPath(),t.moveTo(e[0][0],e[0][1]);for(var i=1;i<e.length;i++)t.lineTo(e[i][0],e[i][1]);t.closePath(),t.globalCompositeOperation="destination-in",t.fill(),t.globalCompositeOperation="source-over"}}]),t}()),N=i("a09c"),B=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.showSelect,expression:"showSelect"}],staticClass:"tools-mainbox"},[i("div",{staticClass:"tools-layout"},[i("div",{staticClass:"tools-button",on:{click:t.reset}},[i("a-icon",{style:{fontSize:".25rem"},attrs:{"two-tone-color":"#1890ff",type:"interaction",theme:"twoTone"}}),i("p",[t._v("重置")])],1),i("div",{staticClass:"tools-button",on:{click:t.deleteImage}},[i("a-icon",{style:{fontSize:".25rem"},attrs:{type:"delete",theme:"twoTone","two-tone-color":"#1890ff"}}),i("p",[t._v("删除")])],1)])])},H=[],W={props:{mode:String},data:function(){return{showSelect:!1}},created:function(){},computed:{rommInfo:function(){var t=this.$store.state.user.roomInfo;return t}},watch:{},methods:{onClose:function(){this.showSelect=!1},deleteImage:function(){this.$emit("deleteImage")},reset:function(){this.$emit("reset")},perspective:function(){this.$emit("perspective")}}},q=W,K=(i("f26c"),Object(u["a"])(q,B,H,!1,null,"6bb649b6",null)),F=K.exports,V=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"tools-mainbox-left"},[i("div",{staticClass:"tools-layout-left"},[i("div",{staticClass:"tools-button"},[i("a-icon",{style:{fontSize:".2rem"},attrs:{type:"experiment",theme:"twoTone","two-tone-color":"#1890ff"}}),i("p",[t._v("色彩饱和")])],1),i("div",{staticClass:"tools-button"},[i("a-icon",{style:{fontSize:".2rem"},attrs:{type:"bulb",theme:"twoTone","two-tone-color":"#1890ff"}}),i("p",[t._v("明暗度")])],1),i("div",{staticClass:"tools-button"},[i("a-icon",{style:{fontSize:".2rem"},attrs:{type:"minus-circle",theme:"twoTone","two-tone-color":"#ff1c1c"}}),i("p",[t._v("清除选区")])],1)])]),i("div",{staticClass:"tools-mainbox-right"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"tools-layout"},[i("div",{staticClass:"tools-button",class:{active:"addArea"==t.mode}},[i("a-icon",{style:{fontSize:".2rem"},attrs:{type:"shop",theme:"twoTone","two-tone-color":"#1890ff"}}),i("p",[t._v("窗帘搭配")])],1),i("div",{staticClass:"tools-button",class:{active:"addArea"==t.mode}},[i("a-icon",{style:{fontSize:".2rem"},attrs:{type:"api",theme:"twoTone","two-tone-color":"#1890ff"}}),i("p",[t._v("窗帘开合")])],1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"tools-layout"},[i("div",{staticClass:"tools-button",class:{active:"addArea"==t.mode}},[i("a-icon",{style:{fontSize:".2rem"},attrs:{type:"file-image",theme:"twoTone","two-tone-color":"#1890ff"}}),i("p",[t._v("墙布搭配")])],1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:!0,expression:"true"}],staticClass:"tools-layout"},[i("div",{staticClass:"tools-button",class:{active:"addArea"==t.mode},on:{click:t.perspectiveRandom}},[i("a-icon",{style:{fontSize:".2rem"},attrs:{type:"gold",theme:"twoTone","two-tone-color":"addArea"==t.mode?"#ff1c1c":"#1890ff"}}),i("p",[t._v("自由变形")])],1),i("div",{staticClass:"tools-button",class:{active:"addArea"==t.mode},on:{click:t.addArea}},[i("a-icon",{style:{fontSize:".2rem"},attrs:{type:"flag",theme:"twoTone","two-tone-color":"addArea"==t.mode?"#ff1c1c":"#1890ff"}}),i("p",[t._v("一键变形")])],1),i("div",{staticClass:"tools-button",class:{active:"addArea"==t.mode},on:{click:t.addArea}},[i("a-icon",{style:{fontSize:".2rem"},attrs:{type:"interaction",theme:"twoTone","two-tone-color":"addArea"==t.mode?"#ff1c1c":"#1890ff"}}),i("p",[t._v("恢复原状")])],1),i("div",{staticClass:"tools-button",class:{active:"addArea"==t.mode},on:{click:t.addArea}},[i("a-icon",{style:{fontSize:".2rem"},attrs:{type:"minus-circle",theme:"twoTone","two-tone-color":"#ff1c1c"}}),i("p",[t._v("删除装饰画")])],1)])]),t.hidestatus?i("div",{directives:[{name:"show",rawName:"v-show",value:"addArea"===t.mode,expression:"mode === 'addArea'"}],staticClass:"tools-bottom-box"},[i("div",{staticClass:"tools-bottom-layout"},[i("div",{class:t.circlestatus?"tools-bottom-button circle":"tools-bottom-button",on:{click:t.addRect}},[i("a-icon",{style:{fontSize:".2rem"},attrs:{type:"edit",theme:"twoTone","two-tone-color":"#1890ff"}}),i("p",{staticStyle:{"white-space":"nowrap"}},[t._v("添加正方形")])],1)])]):t._e(),t.hidestatus?i("div",{directives:[{name:"show",rawName:"v-show",value:"addMini"===t.mode,expression:"mode === 'addMini'"}],staticClass:"tools-bottom-box"},[i("div",{staticClass:"tools-bottom-layout"},[i("div",{class:t.minuscircletatus?"tools-bottom-button circle":"tools-bottom-button",on:{click:t.addKouchuArea}},[i("a-icon",{style:{fontSize:".2rem"},attrs:{type:"edit",theme:"twoTone","two-tone-color":"#1890ff"}}),i("p",[t._v("手绘扣除")])],1),i("div",{staticClass:"tools-bottom-button",on:{click:t.rebackKouchuArea}},[i("a-icon",{style:{fontSize:".2rem"},attrs:{type:"right-circle",theme:"twoTone","two-tone-color":"#1890ff"}}),i("p",[t._v("撤销")])],1),i("div",{staticClass:"tools-bottom-button",on:{click:t.deleteArea}},[i("a-icon",{style:{fontSize:".2rem"},attrs:{type:"delete",theme:"twoTone","two-tone-color":"#1890ff"}}),i("p",[t._v("删除")])],1),i("div",{staticClass:"tools-bottom-button",on:{click:t.cancelKouchuArea}},[i("a-icon",{style:{fontSize:".2rem"},attrs:{type:"thunderbolt",theme:"twoTone","two-tone-color":"#ff1c1c"}}),i("p",[t._v("全部清空")])],1)])]):t._e(),i("a-drawer",{staticClass:"remark-popup",attrs:{title:"客户姓名电话",placement:"right",closable:!1,width:"2rem",visible:t.showSelect,"get-container":!1,"wrap-style":{position:"absolute"}},on:{close:t.onClose}},[i("div",[i("a-input",{staticStyle:{"margin-bottom":".1rem","font-size":".12rem"},attrs:{placeholder:"请输入姓名"},model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}}),i("a-input",{staticStyle:{"font-size":".12rem"},attrs:{type:"tel",placeholder:"请输入电话"},model:{value:t.search.phone,callback:function(e){t.$set(t.search,"phone",e)},expression:"search.phone"}}),i("div",{staticStyle:{margin:"0px auto",width:"100%","margin-top":"70%"}},[i("a-button",{staticStyle:{"font-size":".12rem",height:".25rem","margin-left":"10px"},attrs:{type:"primary"},on:{click:t.handleConfirm}},[t._v("确认")]),i("a-button",{staticStyle:{"font-size":".12rem",height:".25rem","margin-left":"10px"},attrs:{type:"danger"},on:{click:t.handleCancel}},[t._v("取消")])],1)],1)])],1)},Y=[],U=(i("841c"),{props:{mode:String},data:function(){return{showSelect:!1,search:{name:"",phone:""},hidestatus:!0,circlestatus:!0,minuscircletatus:!0}},created:function(){},computed:{rommInfo:function(){var t=this.$store.state.user.roomInfo;return t}},watch:{rommInfo:{handler:function(t){"{}"!==JSON.stringify(t)&&(this.search.name=this.rommInfo.customer_name||"",this.search.phone=this.rommInfo.customer_mobile||"")},immediate:!0}},methods:{perspectiveRandom:function(){console.log("hahha ")},onClose:function(){this.showSelect=!1},handleConfirm:function(){this.search.name||this.search.phone?this.showSelect=!1:this.$message.warning("请输入姓名或者手机号")},handleCancel:function(){this.showSelect=!1},showPopup:function(){this.showSelect=!0},hideTools:function(){this.hidestatus=!this.hidestatus},addArea:function(){this.hidestatus=!0,this.$emit("addArea")},addNewArea:function(){},addRect:function(){this.$emit("addRect"),this.circlestatus=!1},rebackRect:function(){this.$emit("rebackRect")},clearAreas:function(){this.$emit("clearAreas"),console.log("清空当下选区poionts数组")},deleteArea:function(){this.$emit("deleteArea")},saveNewArea2:function(){this.$emit("saveNewArea")},saveNewArea:function(){var t=this;this.$confirm({content:"是否保存再退出?",okText:"保存并退出",cancelText:"直接退出",centered:!0,onOk:function(){t.$emit("saveNewArea")},onCancel:function(){t.$parent.$parent.$emit("showEdit",!1),t.$message.warning("未保存，直接退出",1)}})},reduceArea:function(){this.hidestatus=!0,this.$emit("reduceArea")},addKouchuArea:function(){this.$emit("addKouchuArea"),this.minuscircletatus=!1},rebackKouchuArea:function(){this.$emit("rebackKouchuArea")},cancelKouchuArea:function(){this.$emit("cancelKouchuArea")},finishMiniArea:function(){this.$emit("finishMiniArea")},saveKouchuArea:function(){},manageLayer:function(){this.$message.info("开发中，敬请期待")},exitEdit:function(){this.$parent.$parent.$emit("showEdit",!1)}}}),J=U,G=(i("f86b"),i("81c8"),Object(u["a"])(J,V,Y,!1,null,"0b88908d",null)),X=G.exports,Z={data:function(){return{}},mounted:function(){},computed:{},methods:{getDecrDom:function(){this.decrCanvas=document.getElementById("decr"),this.decrcCtx=this.decrCanvas.getContext("2d")},deleteImage:function(){this.$refs.zsTools.showSelect=!1;var t=this.canvas.getActiveObject();t?this.canvas.remove(t):this.$message.info("请选择装饰画")},resetImage:function(){var t=this.canvas.getActiveObject();t?this.canvas.remove(t):this.$message.info("请选择装饰画"),this.addDecorativeObject(this.selectedMateril.image)},perspectiveImage:function(){this.startPersPect()},startPersPect:function(){var t=this.canvas.getActiveObject(),e=[],i=t.left,a=t.top;for(var n in t.oCoords){var s=t.oCoords[n];e.push([Number((s.x-i)*this.ratio.toFixed(2)),Number((s.y-a)*this.ratio.toFixed(2))])}var o=t.width,r=t.height;this.decrCanvas.width=o*this.ratio,this.decrCanvas.height=r*this.ratio,this.perspective=new z(this.decrcCtx,this.imgElement),this.decrcCtx.clearRect(0,0,this.decrCanvas.width,this.decrCanvas.height),this.perspective.draw(e),this.testImage=this.decrCanvas.toDataURL(),this.addPatternDecr(this.decrCanvas,this.selectedMateril.parent_category_id),console.log(e,o,r,"points")},addPatternDecr:function(t,e){var i=this;fabric.Image.fromURL(t.toDataURL(),(function(t){var e=i.activePoly.width/t.width,a=i.activePoly.height/t.height;t.set({opacity:i.selectedMateril.opacity}),i.activePoly.set("fill",new fabric.Pattern({source:t._element,repeat:"no-repeat",crossOrigin:"anonymous",patternTransform:[e,0,0,a,0,0]})),i.canvas.requestRenderAll()}))},addDecorativeObject:function(t){var e=600,i=600,a=[{x:e/2-100,y:i/2-100},{x:e/2+100,y:i/2-100},{x:e/2+100,y:i/2+100},{x:e/2-100,y:i/2+100}];this.addRectHandler(a,t),this.$refs.zsTools.showSelect=!0},addRectHandler:function(t,e){var i=this,a=new fabric.Polygon(t,{type:"decorative",strokeWidth:1,stroke:"white",objectCaching:!1,transparentCorners:!1,cornerColor:"rgba(0,0,255,0.5)",strokeDashArray:[3,3],fill:"#e7f7ff",cornerStyle:"circle",opacity:this.selectedMateril.opacity||.5});fabric.Image.fromURL(e,(function(t){i.descImg=t;var n=a.width/t.width,s=a.height/t.height;t.set({opacity:i.selectedMateril.opacity}),a.set("fill",new fabric.Pattern({source:t._element,repeat:"no-repeat",crossOrigin:"anonymous",patternTransform:[n,0,0,s,0,0]})),i.canvas.add(a),i.canvas.setActiveObject(a),i.activePoly=i.canvas.getActiveObject();var o=new Image;o.setAttribute("crossOrigin","Anonymous"),o.src=e,o.onload=function(){i.imgElement=o,i.decrCanvas.width=i.activePoly.width,i.decrCanvas.height=i.activePoly.height,i.perspective=new z(i.decrcCtx,o)};var r=i;a.controls=a.points.reduce((function(t,e,i){return t["p"+i]=new fabric.Control({positionHandler:r.polygonPositionHandler(i),actionHandler:r.anchorWrapper(i>0?i-1:a.points.length-1,r.actionHandler),x:.5,y:1,actionName:"modifyPolygon",pointIndex:i}),console.log(t,"acc"),t}),{}),a.hasBorders=!1,i.canvas.renderAll()}))},changeFillImage:function(){this.activePoly=this.canvas.getActiveObject();var t=this.activePoly.width/this.descImg.width,e=this.activePoly.height/this.descImg.height;this.descImg.set({opacity:this.selectedMateril.opacity}),this.activePoly.set("fill",new fabric.Pattern({source:this.descImg._element,repeat:"no-repeat",crossOrigin:"anonymous",patternTransform:[t,0,0,e,0,0]}))},actionHandler:function(t,e,i,a){var n=this,s=e.target,o=s.controls[s.__corner],r=s.toLocalPoint(new fabric.Point(i,a),"center","center"),c=s._getNonTransformedDimensions(),l=s._getTransformedDimensions(0,0),h={x:r.x*c.x/l.x+s.pathOffset.x,y:r.y*c.y/l.y+s.pathOffset.y};return s.points[o.pointIndex]=h,setTimeout((function(){n.startPersPect(s)}),0),!0},polygonPositionHandler:function(t){return function(e,i,a){var n=a.points[t].x-a.pathOffset.x,s=a.points[t].y-a.pathOffset.y;return fabric.util.transformPoint({x:n,y:s},fabric.util.multiplyTransformMatrices(a.canvas.viewportTransform,a.calcTransformMatrix()))}},anchorWrapper:function(t,e){return function(i,a,n,s){var o=a.target,r=fabric.util.transformPoint({x:o.points[t].x-o.pathOffset.x,y:o.points[t].y-o.pathOffset.y},o.calcTransformMatrix()),c=e(i,a,n,s),l=(o._setPositionDimensions({}),o._getNonTransformedDimensions()),h=(o.points[t].x-o.pathOffset.x)/l.x,d=(o.points[t].y-o.pathOffset.y)/l.y;return o.setPositionByOrigin(r,h+.5,d+.5),c}}}},Q=i("7a94").fabric,tt={data:function(){return{showme:"edit"!==this.$route.query.mode,id:this.$route.query.id,testImage:"",canEdit:"undefined"!==this.$route.query.canEdit,canvasHeight:0,canvasWidth:0,selectedMateril:{},imgScale:1,selectedPath:null,selected_Path:null,PathArr:[],Path_Arr:[],Shadow_Path_Arr:[],hotData:[],ratio:2,cScale:1,cDis:0,isLiked:!1,product_list:{},preview:{width:0,height:0},prewVisible:!1,previewImg:"",shutdownStatus:!1,PathSelectStatus:!1,ShowYuntools:!1}},beforeCreate:function(){this.$parent.$off("materialChange")},mixins:[Z],components:{previewImage:N["a"],zsTools:F,yunTools:X},watch:{rommInfo:{handler:function(t){this.hotData=t.areas},immediate:!0},hotData:function(t){this.canvas&&this.bgImg&&this.createPath()}},computed:{curtainIdList:function(){var t=this.$store.state.curtainImageData.editCurtainData;if(t[this.selectedMateril.id]){var e=t[this.selectedMateril.id].selectedCurtainList;if(!e.length)return[];var i=e.map((function(t){return t.id})).filter((function(t){return!!t}));return Object(C["a"])(new Set(i))}return[]},rommInfo:{get:function(){return this.$store.state.user.roomInfo},set:function(t){this.$store.commit("SET_ROOM",t)}},preStyle:function(){return{height:"100vh"}}},created:function(){return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})))()},mounted:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$service.roomDetail({room_id:t.id});case 2:if(i=e.sent,t.$store.commit("SET_ROOM",i),t.rommInfo.image){e.next=6;break}return e.abrupt("return");case 6:a=new Image,a.crossOrigin="anonymous",a.src=t.rommInfo.image,a.onload=function(){t.bgImage=a,t.handleScale(a.width,a.height),t.imgScale=(document.documentElement.clientHeight||document.body.clientHeight)/a.height;var e=document.getElementById("cas");t.scale2=t.imgScale,e.width=a.width*t.scale2*t.ratio,e.height=a.height*t.scale2*t.ratio,t.canvasWidth=a.width*t.imgScale,t.canvasHeight=a.height*t.imgScale,t.getDecrDom(),t.$nextTick((function(){t.canvas=new Q.Canvas("myCanvas",{}),Q.Object.prototype.transparentCorners=!1;var e=new Q.Image(a);if(e.scale(t.imgScale),e.set("selectable",!1),t.bgImg=e,t.canvas.add(e),t.createPath("first"),"/home/design-list"===t.$parent.from){var i=new Image;i.crossOrigin="anonymous",i.src=t.rommInfo.image_deduct,i.onload=function(){var e=new Q.Image(i);e.scale(t.imgScale),e.set({selectable:!1}),t.bgImg2=e,t.canvas.add(e),t.levelHander()}}t.$parent.$on("showEdit",(function(e){t.showme=!e})),t.$parent.$on("reset",(function(){t.Path_Arr.forEach((function(t){t.set({fill:"transparent"})})),t.product_list={},t.canvas.requestRenderAll()})),t.$parent.$on("deleteSelected",(function(){console.log("清空所选择的产品，单选")})),t.$parent.$on("toggleBottom",(function(e){t.shutdownStatus=e,e?t.pathInit():t.PathArr.forEach((function(t){t.set({stroke:"transparent"})})),t.canvas.requestRenderAll()})),t.handlerFillArea()}))},t.$parent.$on("ShowYuntools",(function(){t.ShowYuntools=!t.ShowYuntools}));case 11:case"end":return e.stop()}}),e)})))()},methods:{pathInit:function(){this.PathArr.forEach((function(t){t.set({stroke:"#e6e6e6",strokeDashArray:[2,2]})})),this.canvas.requestRenderAll()},pathInitHide:function(){this.PathArr.forEach((function(t){t.set({stroke:"transparent",strokeDashArray:[2,2]})})),this.canvas.requestRenderAll()},shutdown:function(){this.shutdownStatus?this.pathInitHide():this.pathInit(),this.shutdownStatus=!this.shutdownStatus,this.PathSelectStatus=!1,this.$parent.$emit("showBorder2",this.showBorder2)},handlerFillArea:function(){var t=this;this.$parent.$on("materialChange",function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(i){var a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.selectedMateril=i.content,15!==Number(t.selectedMateril.parent_category_id)){e.next=4;break}return t.addDecorativeObject(i.content.image),e.abrupt("return");case 4:t.selected_Path?(a="p"+t.selected_Path.name,t.selectedMateril&&t.selected_Path.name&&(t.selectedMateril.zijian_product_id>0?"dapei"===i.from&&t.curtainIdList.length?t.product_list[a]=t.curtainIdList:t.product_list[a]=[t.selectedMateril.zijian_product_id,t.selectedMateril.peibu1_product_id,t.selectedMateril.peibu2_product_id].filter((function(t){return t})):t.product_list[a]=t.selectedMateril.id),n=new Image,n.setAttribute("crossOrigin","Anonymous"),n.src=i.content.image,n.onload=function(){t.handlePerspective(n)}):t.$message.info("请点击选区");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},handlePerspective:function(t){for(var e=this,i=document.getElementById("cas"),a=document.getElementById("cas1"),n=this.selectedPath.points.map((function(t){return Number(t)*e.scale2*e.ratio})),s=i.getContext("2d"),o=a.getContext("2d"),r=[],c=[],l=0;l<n.length;l+=2){var h=Number(n[l]),d=Number(n[l+1]);r.push({x:h,y:d}),c.push([h,d])}var u,m=Math.min.apply(Math,Object(C["a"])(r.map((function(t){return t.x})))),f=Math.min.apply(Math,Object(C["a"])(r.map((function(t){return t.y})))),p=2,g=this.selectedPath.width*p,v=this.selectedPath.height*p,w=v/6,y=w*(t.width/t.height),b=Math.ceil(g/y),x=Math.ceil(v/w);console.log(b,x,"nx and ny"),Math.abs(r[1].y-r[0].y)>20&&(u=this.getDistance(r[0],r[1]),u*=p,b=Math.ceil(u/y));var _=g,k=v;if(2==this.selectedMateril.parent_category_id&&(_=b*y,k=x*w),a.width=_,a.height=k,m=0,f=0,o.save(),2==this.selectedMateril.parent_category_id)for(var A=0;A<b;A++)for(var $=0;$<x;$++)o.drawImage(t,m+y*A,f+w*$,y+1,w+1);else if(1==this.selectedMateril.parent_category_id)o.drawImage(t,m,f,_,k);else if(17==this.selectedMateril.parent_category_id)if(Math.abs(r[1].y-r[0].y)>20)o.drawImage(t,m,f,_,k);else{var I,S;_=u||_,t.width/t.height<_/k?(I=_,S=(I/t.width*t.height).toFixed(2)):(S=k,I=(S/t.height*t.width).toFixed(2));var P=-(I-_)/2,T=-(S-k)/2;o.drawImage(t,P,T,I,S)}s.restore(),o.restore();var O=new Image;O.setAttribute("crossOrigin","Anonymous"),O.src=a.toDataURL("image/jpeg"),O.onload=function(){e.handleDrawImage(s,i,c,O)}},handleDrawImage:function(t,e,i,a){t.globalAlpha=this.selectedMateril.opacity;var n=new z(t,a);t.clearRect(0,0,e.width,e.height),n.draw(i),this.addPattern(e,this.selectedMateril.parent_category_id)},addPattern:function(t,e){var i=this;this.selected_Path&&Q.Image.fromURL(t.toDataURL(),(function(t){var e=i.canvas.height/t.height;t.set({opacity:i.selectedMateril.opacity}),i.selected_Path.set("fill",new Q.Pattern({source:t._element,repeat:"no-repeat",crossOrigin:"anonymous",patternTransform:[e,0,0,e,0,0],product_idd:i.selectedMateril.id})),i.canvas.requestRenderAll()}))},createPath:function(t){var e=this;this.PathArr.length&&(this.PathArr.forEach((function(t,i){e.canvas.remove(t),e.canvas.remove(e.Path_Arr[i])})),this.Path_Arr=[],this.PathArr=[]),this.cutBgImg&&this.canvas.remove(this.cutBgImg),this.cutBgImg=null;var i=[];if(this.hotData.forEach((function(t,a){if(0==t.area_type){var n=e.imgScale,s="",o=t.points.split(",");s+="M ".concat(o[0]*n," ").concat(o[1]*n," ");for(var r=2;r<o.length;r+=2)s+="L ".concat(o[r]*n," ").concat(o[r+1]*n," ");s+="z";var c=e.canvas.width,l=e.canvas.height,h="M 0 0 L ".concat(c," 0 L ").concat(c," ").concat(l," L 0 ").concat(l),d=new Q.Path(s),u=new Q.Path(h);new Q.Shadow({color:"black",blur:10});d.set({selectable:!1,stroke:"#e6e6e6",fill:"transparent",hasBorder:!0,name:t.id,points:o,strokeDashArray:[2,2]}),u.set({selectable:!1,stroke:"transparent",fill:"transparent",name:t.id}),e.PathArr.push(d),e.Path_Arr.push(u),e.canvas.add(d),e.canvas.add(u)}else if(1==t.area_type){var m="",f=e.bgImage.width/2,p=e.bgImage.height/2,g=t.points.split(",");m+="M ".concat(g[0]-f," ").concat(g[1]-p," ");for(var v=2;v<g.length;v+=2)m+="L ".concat(g[v]-f," ").concat(g[v+1]-p," ");m+="z",i.push(m)}})),i.length){this.cutBgImg=new Q.Image(this.bgImage),this.cutBgImg.scale(this.imgScale),this.cutBgImg.set({selectable:!1});var a=new Q.Group(i.map((function(t){return new Q.Path(t)})),{});this.cutBgImg.clipPath=a,this.canvas.add(this.cutBgImg)}t||this.levelHander(),this.canvas.on("mouse:down",(function(t){var i=new Q.Shadow({color:"black",blur:10});t.target&&"decorative"!==t.target.type?e.$refs.zsTools.showSelect=!1:e.$refs.zsTools.showSelect=!0,e.selected_Path=e.Path_Arr.find((function(e){return e.name===t.target.name})),e.selectedPath=e.PathArr.find((function(e){return e.name===t.target.name})),e.$parent.$emit("selecedstatus",e.selected_Path),e.PathArr.forEach((function(t){t.set({stroke:"#e6e6e6",strokeDashArray:[2,2]})})),e.selectedPath&&(e.selectedPath.set({stroke:"#1b50fd",strokeDashArray:[],shadow:i}),e.$parent.$emit("showBorder",e.showBorder),e.shutdownStatus=!0,e.PathSelectStatus=!0)}))},levelHander:function(){var t=this;this.bgImg&&this.canvas.moveTo(this.bgImg,1),this.Path_Arr.forEach((function(e){t.canvas.moveTo(e,6)})),this.bgImg2&&this.canvas.moveTo(this.bgImg2,8),this.cutBgImg&&this.canvas.moveTo(this.cutBgImg,10),this.PathArr.forEach((function(e){t.canvas.moveTo(e,20)}))},putCurtainImg:function(){var t=this.$store.state.curtainImageData.base64;this.$parent.$emit("materialChange",{from:"dapei",content:Object(E["a"])(Object(E["a"])({},this.selectedMateril),{},{image:t})})},getDistance:function(t,e){var i=e.x-t.x,a=e.y-t.y;return Math.sqrt(i*i+a*a)},handleScale:function(t,e){this.preview.width=t,this.preview.height=e,this.imgScale=(document.documentElement.clientHeight||document.body.clientHeight)/this.preview.height},Like:function(){var t=this;this.$message.loading({content:"加载中..."}),this.canEdit?this.$service.saveDesignImage({room_id:this.rommInfo.id,image:this.previewImg,type:"collect_my_img",customer_name:this.rommInfo.customer_name||"",customer_mobile:this.rommInfo.customer_mobile||"",product_list:JSON.stringify(this.product_list)}).then((function(e){t.isLiked=!0,t.$message.destroy()})):this.$service.saveDesignImage({room_id:this.rommInfo.id,image:this.previewImg,type:"collect_dbk_img",product_list:JSON.stringify(this.product_list)}).then((function(e){t.isLiked=!0,t.$message.destroy()}))},userOffer:function(){var t=this;this.$message.loading("加载中..."),this.$service.saveDesignImage({room_id:this.rommInfo.id,image:this.previewImg,type:"offer",customer_name:this.rommInfo.customer_name||"",customer_mobile:this.rommInfo.customer_mobile||"",product_list:JSON.stringify(this.product_list)}).then((function(e){t.$message.destroy(),t.$router.push({path:"/inventory",query:{id:e.id}})}))},previewImageSave:function(){"{}"!==JSON.stringify(this.product_list)?(this.PathArr.forEach((function(t){t.set({stroke:""})})),this.previewImg=this.canvas.toDataURL({enableRetinaScaling:!0,format:"jpeg",quality:.7}),this.prewVisible=!0,this.isLiked=!1):this.$message.info("请您选择搭配产品")},downLoadSuccess:function(){this.prewVisible=!1},getFillMaterial:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$service.roomProduct({product_id:t.selectedMateril.id,room_id:t.rommInfo.id,room_area_id:t.selectedPath.name});case 2:return i=e.sent,e.abrupt("return",i);case 4:case"end":return e.stop()}}),e)})))()}}},et=tt,it=(i("26fd"),Object(u["a"])(et,L,R,!1,null,"73f314e5",null)),at=it.exports,nt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"layout-edit"},[i("tools",{ref:"tools",attrs:{mode:t.mode,rommInfo:t.rommInfo},on:{saveNewArea:t.saveNewArea,clearAreas:t.clearAreas,rebackRect:t.deleteArea,addKouchuArea:t.addKouchuArea,reduceArea:t.reduceArea,addArea:t.addArea,addRect:t.addRect,finishMiniArea:t.finishMiniArea,cancelKouchuArea:t.cancelKouchuArea,deleteArea:t.deleteArea,rebackKouchuArea:t.rebackKouchuArea}}),i("canvas",{ref:"editCanvas",attrs:{width:t.canvasWidth,height:t.canvasHeight,id:"editCanvas"}})],1)},st=[],ot=(i("a15b"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"tools-mainbox-left"},[i("div",{staticClass:"tools-layout-left"},[i("div",{staticClass:"tools-button",on:{click:t.showPopup}},[i("a-icon",{style:{fontSize:".25rem"},attrs:{type:"edit",theme:"twoTone","two-tone-color":"#1890ff"}}),i("p",[t._v("场景备注")])],1)])]),i("div",{staticClass:"tools-mainbox"},[i("div",{staticClass:"tools-layout"},[i("div",{staticClass:"tools-button",class:{active:"addArea"==t.mode},on:{click:t.addArea}},[i("a-icon",{style:{fontSize:".25rem"},attrs:{type:"plus-circle",theme:"twoTone","two-tone-color":"addArea"==t.mode?"#ff1c1c":"#1890ff"}}),i("p",[t._v("添加选区")])],1),i("div",{staticClass:"tools-button",class:{active:"addMini"==t.mode},on:{click:t.reduceArea}},[i("a-icon",{style:{fontSize:".25rem"},attrs:{type:"minus-circle",theme:"twoTone","two-tone-color":"addMini"==t.mode?"#ff1c1c":"#1890ff"}}),i("p",[t._v("扣除选区")])],1),t.hidestatus?i("div",{staticClass:"tools-button",on:{click:t.hideTools}},[i("a-icon",{style:{fontSize:".25rem"},attrs:{type:"eye",theme:"twoTone","two-tone-color":"#1890ff"}}),i("p",[t._v("隐藏工具栏")])],1):t._e(),t.hidestatus?t._e():i("div",{staticClass:"tools-button",on:{click:t.hideTools}},[i("a-icon",{style:{fontSize:".25rem"},attrs:{type:"eye-invisible",theme:"twoTone","two-tone-color":"#b7b7b7"}}),i("p",[t._v("显示工具栏")])],1),i("div",{staticClass:"tools-button",staticStyle:{border:"none"},on:{click:t.saveNewArea}},[i("a-icon",{style:{fontSize:".25rem"},attrs:{type:"folder",theme:"twoTone","two-tone-color":"#1890ff"}}),i("p",[t._v("保存退出")])],1)])]),t.hidestatus?i("div",{directives:[{name:"show",rawName:"v-show",value:"addArea"===t.mode,expression:"mode === 'addArea'"}],staticClass:"tools-bottom-box"},[i("div",{staticClass:"tools-bottom-layout"},[i("div",{class:t.circlestatus?"tools-bottom-button circle":"tools-bottom-button",on:{click:t.addRect}},[i("a-icon",{style:{fontSize:".25rem"},attrs:{type:"edit",theme:"twoTone","two-tone-color":"#1890ff"}}),i("p",{staticStyle:{"white-space":"nowrap"}},[t._v("添加正方形")])],1),i("div",{staticClass:"tools-bottom-button",on:{click:t.deleteArea}},[i("a-icon",{style:{fontSize:".25rem"},attrs:{type:"delete",theme:"twoTone","two-tone-color":"#1890ff"}}),i("p",[t._v("删除")])],1),i("div",{staticClass:"tools-bottom-button",on:{click:t.clearAreas}},[i("a-icon",{style:{fontSize:".25rem"},attrs:{type:"thunderbolt",theme:"twoTone","two-tone-color":"#ff1c1c"}}),i("p",[t._v("全部清空")])],1)])]):t._e(),t.hidestatus?i("div",{directives:[{name:"show",rawName:"v-show",value:"addMini"===t.mode,expression:"mode === 'addMini'"}],staticClass:"tools-bottom-box"},[i("div",{staticClass:"tools-bottom-layout"},[i("div",{class:t.minuscircletatus?"tools-bottom-button circle":"tools-bottom-button",on:{click:t.addKouchuArea}},[i("a-icon",{style:{fontSize:".25rem"},attrs:{type:"edit",theme:"twoTone","two-tone-color":"#1890ff"}}),i("p",[t._v("手绘扣除")])],1),i("div",{staticClass:"tools-bottom-button",on:{click:t.rebackKouchuArea}},[i("a-icon",{style:{fontSize:".25rem"},attrs:{type:"right-circle",theme:"twoTone","two-tone-color":"#1890ff"}}),i("p",[t._v("撤销")])],1),i("div",{staticClass:"tools-bottom-button",on:{click:t.deleteArea}},[i("a-icon",{style:{fontSize:".25rem"},attrs:{type:"delete",theme:"twoTone","two-tone-color":"#1890ff"}}),i("p",[t._v("删除")])],1),i("div",{staticClass:"tools-bottom-button",on:{click:t.cancelKouchuArea}},[i("a-icon",{style:{fontSize:".25rem"},attrs:{type:"thunderbolt",theme:"twoTone","two-tone-color":"#ff1c1c"}}),i("p",[t._v("全部清空")])],1)])]):t._e(),i("a-drawer",{staticClass:"remark-popup",attrs:{title:"客户姓名电话",placement:"right",closable:!1,width:"2rem",visible:t.showSelect,"get-container":!1,"wrap-style":{position:"absolute"}},on:{close:t.onClose}},[i("div",[i("a-input",{staticStyle:{"margin-bottom":".1rem","font-size":".12rem"},attrs:{placeholder:"请输入姓名"},model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}}),i("a-input",{staticStyle:{"font-size":".12rem"},attrs:{type:"tel",placeholder:"请输入电话"},model:{value:t.search.phone,callback:function(e){t.$set(t.search,"phone",e)},expression:"search.phone"}}),i("div",{staticStyle:{margin:"0px auto",width:"100%","margin-top":"70%"}},[i("a-button",{staticStyle:{"font-size":".12rem",height:".25rem","margin-left":"10px"},attrs:{type:"primary"},on:{click:t.handleConfirm}},[t._v("确认")]),i("a-button",{staticStyle:{"font-size":".12rem",height:".25rem","margin-left":"10px"},attrs:{type:"danger"},on:{click:t.handleCancel}},[t._v("取消")])],1)],1)])],1)}),rt=[],ct={props:{mode:String},data:function(){return{showSelect:!1,search:{name:"",phone:""},hidestatus:!0,circlestatus:!0,minuscircletatus:!0}},created:function(){},computed:{rommInfo:function(){var t=this.$store.state.user.roomInfo;return t}},watch:{rommInfo:{handler:function(t){"{}"!==JSON.stringify(t)&&(this.search.name=this.rommInfo.customer_name||"",this.search.phone=this.rommInfo.customer_mobile||"")},immediate:!0}},methods:{onClose:function(){this.showSelect=!1},handleConfirm:function(){this.search.name||this.search.phone?this.showSelect=!1:this.$message.warning("请输入姓名或者手机号")},handleCancel:function(){this.showSelect=!1},showPopup:function(){this.showSelect=!0},hideTools:function(){this.hidestatus=!this.hidestatus},addArea:function(){this.hidestatus=!0,this.$emit("addArea")},addNewArea:function(){},addRect:function(){this.$emit("addRect"),this.circlestatus=!1},rebackRect:function(){this.$emit("rebackRect")},clearAreas:function(){this.$emit("clearAreas"),console.log("清空当下选区poionts数组")},deleteArea:function(){this.$emit("deleteArea")},saveNewArea2:function(){this.$emit("saveNewArea")},saveNewArea:function(){var t=this;this.$confirm({content:"是否保存再退出?",okText:"保存并退出",cancelText:"直接退出",centered:!0,onOk:function(){t.$emit("saveNewArea")},onCancel:function(){t.$parent.$parent.$emit("showEdit",!1),t.$message.warning("未保存，直接退出",1)}})},reduceArea:function(){this.hidestatus=!0,this.$emit("reduceArea")},addKouchuArea:function(){this.$emit("addKouchuArea"),this.minuscircletatus=!1},rebackKouchuArea:function(){this.$emit("rebackKouchuArea")},cancelKouchuArea:function(){this.$emit("cancelKouchuArea")},finishMiniArea:function(){this.$emit("finishMiniArea")},saveKouchuArea:function(){},manageLayer:function(){this.$message.info("开发中，敬请期待")},exitEdit:function(){this.$parent.$parent.$emit("showEdit",!1)}}},lt=ct,ht=(i("2638"),i("354c"),Object(u["a"])(lt,ot,rt,!1,null,"525328b0",null)),dt=ht.exports,ut=(i("a434"),{data:function(){return{miniFinished:!0,selectedPath:null,can:{canvas:new Object,id:"",w:0,h:0,pointList:new Array,tempPoint:{},currentPoints:[],roundr:7,roundrr:7,paint:!1,juPull:!1,pulledCircle:null,IsClose:!1,lastPoint:{}}}},computed:{canAddArea:function(){return!this.miniFinished&&"addMini"===this.mode}},methods:{deletePath:function(t){var e=this;t&&(this.canvas.remove(t),t.circleArr&&t.circleArr.length&&t.circleArr.forEach((function(t){e.canvas.remove(t)})))},initMiniEvent:function(){var t=this;this.canvas.on("mouse:down",(function(e){t.can.paint=!0,t.miniFinished&&("miniArea"===e.target.type&&(t.canvas.getObjects().filter((function(t){return"miniArea"===t.type})).forEach((function(t){t.set({stroke:"red",strokeDashArray:[3,3]})})),e.target.set({stroke:"green",strokeDashArray:[]}),t.selectedPath=e.target),"circle-point"===e.target.type?(t.can.juPull=!0,t.can.pulledCircle=e.target):(t.can.juPull=!1,t.can.pulledCircle=null))})),this.canvas.on("mouse:move",(function(e){var i=e.pointer.x,a=e.pointer.y;if(t.can.paint&&t.miniFinished&&t.can.pulledCircle){var n=t.can.pulledCircle.index,s=t.can.pulledCircle.belongtoPath;if(n>=0){var o=s.points;o[n]={pointx:i,pointy:a},s.set({points:o})}t.drawAllPath()}if(t.selectedPath&&t.miniFinished){var r=t.selectedPath.points;t.AddNewNode(i,a,r)}})),this.canvas.on("mouse:up",(function(e){if(t.can.paint=!1,t.canAddArea){var i=t,a=e.pointer.x,n=e.pointer.y,s=t.can.currentPoints;s.push({pointx:a,pointy:n}),i.equalStartPoint(s[s.length-1].pointx,s[s.length-1].pointy),s.length>1?(i.drawLine(s[s.length-2].pointx,s[s.length-2].pointy,s[s.length-1].pointx,s[s.length-1].pointy),i.drawArc(s[s.length-1].pointx,s[s.length-1].pointy,{type:"tempLA"})):i.drawArc(s[s.length-1].pointx,s[s.length-1].pointy,{type:"tempLA"}),i.can.IsClose&&(t.canvas.getObjects().filter((function(t){return"tempLA"===t.type})).forEach((function(e){return t.canvas.remove(e)})),t.updateCurrentPath(t.can.currentPoints),t.can.currentPoints=[],t.miniFinished=!0)}console.log(t.can.pulledCircle,"this.can.pulledCircle"),t.miniFinished&&t.selectedPath&&!t.can.pulledCircle&&t.can.tempPoint.point&&(t.selectedPath.points.splice(t.can.tempPoint.index,0,{pointx:t.can.tempPoint.point.newx,pointy:t.can.tempPoint.point.newy}),t.can.tempPoint={},t.drawAllPath())}))},drawAllPath:function(){var t=this,e=this.canvas.getObjects().filter((function(t){return"miniArea"===t.type}));e.forEach((function(e,i){e&&t.deletePath(e);for(var a=e.points,n="",s=[],o=0;o<a.length;o++)n+=0==o?"M ".concat(a[o].pointx," ").concat(a[o].pointy," "):"L ".concat(a[o].pointx," ").concat(a[o].pointy," ");n+="z";for(var r=t.drawPath(n,{circleArr:s,points:a}),c=0;c<a.length;c++)s.push(t.drawArc(a[c].pointx,a[c].pointy,{type:"circle-point",index:c,belongtoPath:r}))}))},updateCurrentPath:function(t,e){e&&this.deletePath(e);for(var i=t,a="",n=[],s=0;s<i.length;s++)a+=0==s?"M ".concat(i[s].pointx," ").concat(i[s].pointy," "):"L ".concat(i[s].pointx," ").concat(i[s].pointy," ");for(var o=this.drawPath(a,{circleArr:n,points:i}),r=0;r<i.length;r++)n.push(this.drawArc(i[r].pointx,i[r].pointy,{type:"circle-point",index:r,belongtoPath:o}))},drawPath:function(t,e){var i,a=new fabric.Path(t);return a.set(Object(E["a"])((i={selectable:!1,stroke:"red",fill:"transparent",strokeDashArray:[3,3]},Object(c["a"])(i,"fill","#fc0d1b"),Object(c["a"])(i,"opacity",.4),Object(c["a"])(i,"type","miniArea"),i),e)),this.canvas.add(a),this.canvas.moveTo(a,10),a},drawArc:function(t,e,i){var a=new fabric.Circle(Object(E["a"])({selectable:!1,radius:7,originX:"center",originY:"center",top:e,left:t,fill:"blue",zIndex:1e3},i));return a.hoverCursor="default",this.canvas.add(a),this.canvas.moveTo(a,20),a},drawLine:function(t,e,i,a){var n=new fabric.Path("M ".concat(t," ").concat(e," L ").concat(i," ").concat(a));n.set({selectable:!1,stroke:"red",strokeDashArray:[3,3],type:"tempLA"}),this.canvas.add(n)},equalStartPoint:function(t,e){var i=this.can.currentPoints;i.length>2&&Math.abs((t-i[0].pointx)*(t-i[0].pointx))+Math.abs((e-i[0].pointy)*(e-i[0].pointy))<=this.can.roundr*this.can.roundr?(this.can.IsClose=!0,i[i.length-1].pointx=i[0].pointx,i[i.length-1].pointy=i[0].pointy):this.can.IsClose=!1},AddNewNode:function(t,e,i){for(var a=0;a<i.length-1;a++){var n=!1;if(parseFloat(i[a+1].pointx)-parseFloat(i[a].pointx)!=0){var s=parseFloat(i[a+1].pointy-i[a].pointy)/(i[a+1].pointx-i[a].pointx),o=i[a].pointy-s*i[a].pointx,r=parseFloat(s*t+o);if((r<e+4&&r>e-4||parseInt(r)==parseInt(e))&&(t-i[a+1].pointx)*(t-i[a].pointx)<=2&&(e-i[a+1].pointy)*(e-i[a].pointy)<=2){var c=Math.abs(i[a+1].pointx-i[a].pointx-3),l=Math.abs(i[a+1].pointx-t),h=Math.abs(t-i[a].pointx),d=Math.abs(i[a+1].pointy-i[a].pointy-3),u=Math.abs(i[a+1].pointy-e),m=Math.abs(e-i[a].pointy);c<=2||c>=4?l<=c&&h<=c&&u<=d&&m<=d&&(n=!0):l<=c&&h<=c&&(n=!0)}}if((parseFloat(i[a+1].pointx)-parseFloat(i[a].pointx)==0||Math.abs(parseFloat(i[a+1].pointx)/parseFloat(i[a].pointx))>=15)&&i[a].pointx+3>=t&&i[a].pointx-3<=t){d=Math.abs(i[a+1].pointy-i[a].pointy-3),u=Math.abs(i[a+1].pointy-e),m=Math.abs(e-i[a].pointy);u<=d&&m<=d&&(n=!0)}if(n)return this.can.tempPoint.point={newx:t,newy:e},this.can.tempPoint.index=a+1,a++,void(this.can.tempPoint.point&&this.drawArcBig(this.can.tempPoint.point.newx,this.can.tempPoint.point.newy))}this.can.tempPoint={},this.tempCircle&&this.canvas.remove(this.tempCircle)},drawArcBig:function(t,e){this.tempCircle&&this.canvas.remove(this.tempCircle);var i=new fabric.Circle({selectable:!1,radius:this.can.roundr+2,originX:"center",originY:"center",top:e,left:t,fill:"blue",zIndex:1e3});return this.canvas.add(i),this.canvas.moveTo(i,9),this.tempCircle=i,i}}}),mt={data:function(){return{id:this.$route.query.id,canvasHeight:0,canvasWidth:0,imgScale:1,cScale:1.5,mode:"addArea"}},mixins:[ut],components:{Tools:dt},watch:{mode:function(t){this.handlerAreaToogle(t)}},computed:{rommInfo:{get:function(){var t=this.$store.state.user.roomInfo;return t},set:function(t){this.$store.commit("SET_ROOM",t)}},getAreas:function(){return this.canvas.getObjects().filter((function(t){return"area"===t.type}))||[]},getMiniAreas:function(){return this.canvas.getObjects().filter((function(t){return"miniArea"===t.type}))||[]}},mounted:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$service.roomDetail({room_id:t.id});case 2:i=e.sent,t.rommInfo=i,a=new Image,a.crossOrigin="anonymous",a.src=t.rommInfo.image,a.onload=function(){t.imgScale=(document.documentElement.clientHeight||document.body.clientHeight)/a.height,t.canvasWidth=a.width*t.imgScale,t.canvasHeight=a.height*t.imgScale,t.dituWidth=t.canvasWidth,t.dituHeight=t.canvasHeight,t.$nextTick((function(){t.canvas=new fabric.Canvas("editCanvas",{}),console.log(t.canvas,"this.canvas"),fabric.Object.prototype.transparentCorners=!1;var e=new fabric.Image(a);e.scale(t.imgScale),e.set("selectable",!1),t.bgImg=e,t.canvas.add(e),t.canvas.selection=!1,t.initData(),t.initMiniEvent(),t.handlerAreaToogle(t.mode)}))};case 8:case"end":return e.stop()}}),e)})))()},methods:{addRect:function(){var t=this.dituWidth,e=this.dituHeight,i=[];i=t>400?[{x:t/2-100,y:e/2-100},{x:t/2+100,y:e/2-100},{x:t/2+100,y:e/2+100},{x:t/2-100,y:e/2+100}]:[{x:t/4,y:e/2-t/4},{x:3*t/4,y:e/2-t/4},{x:3*t/4,y:e/2+t/4},{x:t/4,y:e/2+t/4}],this.addRectHandler(i),console.log(this.dituWidth,this.dituHeight,"123123123123123123123")},handlerAreaToogle:function(t){this.canvas&&("addArea"===t?(this.canvas.hoverCursor="move",this.canvas.getObjects().filter((function(t){return"miniArea"===t.type||"circle-point"===t.type})).forEach((function(t,e){t.set({visible:!1})})),this.canvas.getObjects().filter((function(t){return"area"===t.type})).forEach((function(t,e){t.set({selectable:!0})})),this.canvas.renderAll()):"addMini"===t&&(this.canvas.hoverCursor="move",this.canvas.getObjects().filter((function(t){return"area"===t.type})).forEach((function(t,e){t.set({selectable:!1})})),this.canvas.getObjects().filter((function(t){return"miniArea"===t.type||"circle-point"===t.type})).forEach((function(t,e){t.set({visible:!0})})),this.canvas.discardActiveObject(),this.canvas.renderAll()))},initData:function(){var t=this;this.rommInfo.areas.forEach((function(e){var i=[],a=[];if(0==e.area_type){for(var n=e.points.split(","),s=0;s<n.length;s+=2){var o=Number(n[s]),r=Number(n[s+1]);i.push({x:o*t.imgScale,y:r*t.imgScale})}t.addRectHandler(i)}else if(1==e.area_type){for(var c=e.points.split(","),l=0;l<c.length;l+=2){var h=Number(c[l]),d=Number(c[l+1]);a.push({pointx:h*t.imgScale,pointy:d*t.imgScale})}t.updateCurrentPath(a)}}))},deleteArea:function(){if("addMini"===this.mode)this.selectedPath?this.deletePath(this.selectedPath):this.$message.info("请选择选区");else if("addArea"===this.mode){var t=this.canvas.getActiveObject();t?this.canvas.remove(t):this.$message.info("请选择选区")}},addArea:function(){this.mode="addArea"},reduceArea:function(){this.mode="addMini"},addKouchuArea:function(){this.can.IsClose||this.miniFinished?(this.miniFinished=!1,this.canvas.hoverCursor="crosshair"):this.$message.info("请闭合选区")},finishMiniArea:function(){this.miniFinished=!0,this.canvas.hoverCursor="move"},cancelKouchuArea:function(){var t=this;this.canvas.getObjects().filter((function(t){return"miniArea"===t.type})).forEach((function(e){t.deletePath(e)}))},rebackKouchuArea:function(){var t=this;this.can.currentPoints.pop(),this.canvas.getObjects().filter((function(t){return"tempLA"===t.type})).forEach((function(e){return t.canvas.remove(e)}));for(var e=this.can.currentPoints,i=0;i<e.length;i++)i<e.length-1&&this.drawLine(e[i].pointx,e[i].pointy,e[i+1].pointx,e[i+1].pointy),this.drawArc(e[i].pointx,e[i].pointy,{type:"tempLA"})},addRectHandler:function(t){var e=new fabric.Polygon(t,{type:"area",strokeWidth:1,stroke:"white",objectCaching:!1,transparentCorners:!1,cornerColor:"blue",strokeDashArray:[3,3],fill:"#e7f7ff",opacity:.5});this.canvas.add(e),this.canvas.moveTo(e,5);var i=e;this.canvas.setActiveObject(i),i.cornerStyle="circle",i.cornerColor="rgba(0,0,255,0.5)";var a=this;i.controls=i.points.reduce((function(t,e,n){return t["p"+n]=new fabric.Control({positionHandler:a.polygonPositionHandler(n),actionHandler:a.anchorWrapper(n>0?n-1:i.points.length-1,a.actionHandler),x:.5,y:1,actionName:"modifyPolygon",pointIndex:n}),t}),{}),i.hasBorders=!1,this.canvas.renderAll()},polygonPositionHandler:function(t){return function(e,i,a){var n=a.points[t].x-a.pathOffset.x,s=a.points[t].y-a.pathOffset.y;return fabric.util.transformPoint({x:n,y:s},fabric.util.multiplyTransformMatrices(a.canvas.viewportTransform,a.calcTransformMatrix()))}},actionHandler:function(t,e,i,a){var n=e.target,s=n.controls[n.__corner],o=n.toLocalPoint(new fabric.Point(i,a),"center","center"),r=n._getNonTransformedDimensions(),c=n._getTransformedDimensions(0,0),l={x:o.x*r.x/c.x+n.pathOffset.x,y:o.y*r.y/c.y+n.pathOffset.y};return n.points[s.pointIndex]=l,!0},anchorWrapper:function(t,e){return function(i,a,n,s){var o=a.target,r=fabric.util.transformPoint({x:o.points[t].x-o.pathOffset.x,y:o.points[t].y-o.pathOffset.y},o.calcTransformMatrix()),c=e(i,a,n,s),l=(o._setPositionDimensions({}),o._getNonTransformedDimensions()),h=(o.points[t].x-o.pathOffset.x)/l.x,d=(o.points[t].y-o.pathOffset.y)/l.y;return o.setPositionByOrigin(r,h+.5,d+.5),c}},saveNewArea:function(){var t=this,e=[];console.log(this.canvas,"this.canvas"),this.canvas.getObjects().filter((function(t){return"area"===t.type})).map((function(i,a){var n=[];for(var s in i.oCoords){var o=i.oCoords[s];n.push(o.x,o.y)}e.push({name:"新增选区 "+a,area_type:0,points:n.map((function(e){return(e/t.imgScale).toFixed(2)})).join(",")})})),this.canvas.getObjects().filter((function(t){return"miniArea"===t.type})).map((function(i,a){var n=[];i.points.forEach((function(t){n.push(t.pointx,t.pointy)})),e.push({name:"扣除选区 "+a,area_type:1,points:n.map((function(e){return(e/t.imgScale).toFixed(2)})).join(",")})}));var i=this.$refs.tools.search.phone,a=this.$refs.tools.search.name;this.$service.updateRoom({id:this.id,name:this.rommInfo.name,image:this.rommInfo.image,customer_mobile:i,customer_name:a,areas:e}).then((function(e){e.id&&(t.$message.success("保存成功"),t.$parent.$emit("showEdit",!1))})).catch((function(t){}))},clearAreas:function(){var t=this;this.canvas.getObjects().filter((function(t){return"area"===t.type})).forEach((function(e,i){t.canvas.remove(e)}))}}},ft=mt,pt=(i("1529"),Object(u["a"])(ft,nt,st,!1,null,"715bbce9",null)),gt=pt.exports,vt=(i("7a94").fabric,{components:{layoutTop:f,layoutBottom:M,layoutEdit:gt,layoutPreview2:at},data:function(){return{from:"",showEdit:"edit"===this.$route.query.mode,hideBottom:!1,id:this.$route.query.id}},computed:{first_loaded:function(){return this.$store.state.design.first_loaded},loading:function(){return this.$store.state.design.loading}},methods:{previewImage:function(){this.$refs.canvasWrap.previewImageSave()},goDetail:function(){this.$router.push({path:"/inventory",query:{id:this.id}})},hideBottomClick:function(){this.hideBottom=!0},page_init:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$route.query.id||"";case 1:case"end":return e.stop()}}),e)})))()}},beforeRouteEnter:function(t,e,i){t.meta.keepAlive=!1,i((function(t){t.from=e.path}))},beforeRouteLeave:function(t,e,i){i()},created:function(){var t=this;this.page_init(),this.$on("showEdit",function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(i){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.showEdit=i,t.showEdit){e.next=6;break}return e.next=4,t.$service.roomDetail({room_id:t.id});case 4:a=e.sent,t.$store.commit("SET_ROOM",a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}),wt=vt,yt=(i("9890"),i("87ed"),Object(u["a"])(wt,a,n,!1,null,"eee237c6",null));e["default"]=yt.exports},6300:function(t,e,i){},6509:function(t,e,i){},"7b25":function(t,e,i){},"81c8":function(t,e,i){"use strict";i("6300")},"85a8":function(t,e,i){"use strict";i("dc64")},"87ed":function(t,e,i){"use strict";i("eb69")},"91a0":function(t,e,i){},9340:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"back-btn",on:{click:t.goBack}},[i("i",{staticClass:"iconfont icon-left-circle-fill"})])},n=[],s=(i("ac1f"),i("5319"),{props:{backType:""},inject:["reload"],data:function(){return{}},methods:{goBack:function(){"mydesign"===this.backType?this.$router.replace("/my-design"):"back"===this.backType?(this.$router.back(),this.reload()):(this.$router.back(),console.log(this.backType,"222222lallala"))}}}),o=s,r=(i("1b09"),i("2877")),c=Object(r["a"])(o,a,n,!1,null,"c4115dbc",null);e["a"]=c.exports},"94f5":function(t,e,i){},9890:function(t,e,i){"use strict";i("e34aa")},a09c:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a-modal",{staticClass:"preview-modal",attrs:{width:t.screenWidth+"px",height:"100vh",zIndex:1e7,mask:!1,visible:t.prewVisible,fullScreen:!0,closeIcon:t.type="关闭预览",footer:null,title:"方案预览"},on:{cancel:t.cancel}},[i("div",{staticClass:"flex-box",staticStyle:{"justify-content":"center"},style:{height:t.screenHeight/100-.5+"rem",width:"100%"}},[i("img",{directives:[{name:"touchscale",rawName:"v-touchscale"}],staticClass:"preview-img",style:{height:"95%","max-width":"100%"},attrs:{src:t.img},on:{click:t.previewImage}})]),i("div",{staticClass:"design-layout-top-op"},[t.is_inAPP?i("a-icon",{attrs:{type:"mobile",theme:"filled"},on:{click:t.downLoad}}):t._e(),i("a-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isHideLike,expression:"!isHideLike"}],style:{marginLeft:".2rem",color:t.isLiked?"#2593fc":""},attrs:{type:this.canEdit?"star":"heart",theme:"filled"},on:{click:t.Like}}),t.is_inAPP?i("a-icon",{staticStyle:{"margin-left":".2rem"},attrs:{type:"wechat",theme:"filled"},on:{click:t.Share}}):t._e(),i("a-button",{staticStyle:{"font-size":".13rem",width:".6rem"},attrs:{size:"small",type:"primary"},on:{click:t.userOffer}},[t._v("去报价")])],1)])},n=[],s={props:{value:Boolean,img:String,isLiked:Boolean,isHideLike:Boolean},data:function(){return{canEdit:"undefined"!==this.$route.query.canEdit,prewVisible:!1,screenHeight:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,screenWidth:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,is_inAPP:/LT-APP/.test(navigator.userAgent)}},watch:{value:function(t){this.prewVisible=t},prewVisible:function(t){this.$emit("input",t)}},created:function(){},methods:{cancel:function(){this.prewVisible=!1},downLoad:function(){var t=this;jsBridge.ready((function(){jsBridge.saveImageToAlbum(t.img,(function(e){if(e){var i=navigator.userAgent,a=i.indexOf("Android")>-1||i.indexOf("Linux")>-1;a&&(t.$emit("downLoadSuccess"),t.$message.success("保存成功，请到手机相册查看"))}else alert("保存失败：下载失败或没有相册使用权限")}))}))},Like:function(){this.isLiked||this.$emit("Like")},userOffer:function(){console.log("userOffer"),this.$emit("userOffer")},Share:function(t){var e=this;try{jsBridge.ready((function(){jsBridge.shareImage({imgUrl:e.img})}))}catch(t){this.$message.info("亲，正式版用户专享区，期待您的加入！~")}},previewImage:function(){var t=this;try{jsBridge.ready((function(){jsBridge.showImages({screenOrientation:0,save:!0,share:!0,share_text:"德巴克app",items:[{url:t.img,text:""}]})}))}catch(e){this.$message.info("亲，正式版用户专享区，期待您的加入！~")}}}},o=s,r=(i("447a"),i("a98b"),i("2877")),c=Object(r["a"])(o,a,n,!1,null,"3faa6d4d",null);e["a"]=c.exports},a1e8:function(t,e,i){"use strict";i("a5da")},a5da:function(t,e,i){},a5ea:function(t,e,i){},a98b:function(t,e,i){"use strict";i("1166")},afe1:function(t,e,i){},dc64:function(t,e,i){},e34aa:function(t,e,i){},eb69:function(t,e,i){},f26c:function(t,e,i){"use strict";i("94f5")},f86b:function(t,e,i){"use strict";i("1d26")}}]);